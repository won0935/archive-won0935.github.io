{"componentChunkName":"component---src-templates-post-tsx","path":"/category/monitoring/nginx-prometheus/","result":{"data":{"site":{"siteMetadata":{"title":"Jay ê¸°ìˆ  ë¸”ë¡œê·¸","author":"won0935","siteUrl":"https://won0935.github.io"}},"markdownRemark":{"id":"fb0edc67-5013-518c-b648-9a88d2011a02","excerpt":"â›³ ë“¤ì–´ê°€ê¸° ì „ì—.. ğŸ•¹ ìƒí™© ì‚¬ë‚´ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ê°œë°œ ì¤‘ âš™ï¸ ê¸°ìˆ  Data Source í˜„ì¬ ì‹¤í–‰ë˜ê³  ìˆëŠ” ê° ì‹œìŠ¤í…œ fluentd(ë¡œê·¸ìˆ˜ì§‘ê¸°), nginx(WS), spring-actuator(ìƒíƒœìˆ˜ì§‘), kafka(MQ) ë“± Prometheusâ€¦","html":"<h2 id=\"-ë“¤ì–´ê°€ê¸°-ì „ì—\" style=\"position:relative;\"><a href=\"#-%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0-%EC%A0%84%EC%97%90\" aria-label=\" ë“¤ì–´ê°€ê¸° ì „ì— permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>â›³ ë“¤ì–´ê°€ê¸° ì „ì—..</h2>\n<h3 id=\"-ìƒí™©\" style=\"position:relative;\"><a href=\"#-%EC%83%81%ED%99%A9\" aria-label=\" ìƒí™© permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ•¹ ìƒí™©</h3>\n<p>ì‚¬ë‚´ <strong>ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ</strong> ê°œë°œ ì¤‘</p>\n<h3 id=\"ï¸-ê¸°ìˆ \" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EA%B8%B0%EC%88%A0\" aria-label=\"ï¸ ê¸°ìˆ  permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>âš™ï¸ ê¸°ìˆ </h3>\n<h4 id=\"data-source\" style=\"position:relative;\"><a href=\"#data-source\" aria-label=\"data source permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Source</h4>\n<ul>\n<li>í˜„ì¬ ì‹¤í–‰ë˜ê³  ìˆëŠ” ê° ì‹œìŠ¤í…œ</li>\n<li>fluentd(ë¡œê·¸ìˆ˜ì§‘ê¸°), nginx(WS), spring-actuator(ìƒíƒœìˆ˜ì§‘), kafka(MQ) ë“±</li>\n</ul>\n<h4 id=\"prometheus\" style=\"position:relative;\"><a href=\"#prometheus\" aria-label=\"prometheus permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prometheus</h4>\n<ul>\n<li>ë§¤íŠ¸ë¦­ ìˆ˜ì§‘ê¸° &#x26; ì‹œê³„ì—´ DB</li>\n<li>ê° ì‹œìŠ¤í…œì—ì„œ ë³´ë‚´ëŠ” ì •ë³´ë¥¼ ì·¨í•©í•˜ëŠ” ì—­í• </li>\n<li><a href=\"https://prometheus.io/docs/introduction/overview/\">Prometheusë€?</a></li>\n</ul>\n<h4 id=\"grafana\" style=\"position:relative;\"><a href=\"#grafana\" aria-label=\"grafana permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Grafana</h4>\n<ul>\n<li>ë§¤íŠ¸ë¦­ì„ ì‹œê°í™” í•˜ëŠ” ëŒ€ì‰¬ë³´ë“œì˜ ì—­í• </li>\n<li><a href=\"https://play.grafana.org/d/000000012/grafana-play-home?orgId=1\">Grafanaë€?</a></li>\n</ul>\n<h3 id=\"-ë‹¤ì´ì–´ê·¸ë¨\" style=\"position:relative;\"><a href=\"#-%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8\" aria-label=\" ë‹¤ì´ì–´ê·¸ë¨ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ¨ ë‹¤ì´ì–´ê·¸ë¨</h3>\n<p><img src=\"https://user-images.githubusercontent.com/55419159/146768389-a5d3e490-af48-4c14-ad2a-4f3bb0c73d65.png\" alt=\"image\"></p>\n<hr>\n<h2 id=\"-ê°œìš”\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EC%9A%94\" aria-label=\" ê°œìš” permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ•¹ ê°œìš”</h2>\n<p>ì´ ë¬¸ì„œì—ì„œëŠ” <code class=\"language-text\">nginx-prometheus-exporter</code>ë¥¼ ì´ìš©í•´ì„œ <code class=\"language-text\">Nginx</code>ì˜ ì»¤ë„¥ì…˜ ì •ë³´ì— ëŒ€í•œ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•œë‹¤.\nê·¸ í›„ <code class=\"language-text\">Grafana</code>, <code class=\"language-text\">Prometheus</code>ë¥¼ ì´ìš©í•´ì„œ Nginx ì›¹ ì„œë²„ë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì— ëŒ€í•˜ì—¬ ë‹¤ë£¬ë‹¤.\nìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>\n<ul>\n<li>Nginx ì„¤ì¹˜</li>\n<li>nginx-prometheus-exporter ì„¤ì¹˜</li>\n<li>ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì„ ìœ„í•œ ê° ì»´í¬ë„ŒíŠ¸ ì„¤ì •</li>\n<li>Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/55419159/146769477-69fa4854-444c-4dec-b233-86f64d433815.png\" alt=\"image\"></p>\n<hr>\n<h2 id=\"-nginx-ì„¤ì¹˜\" style=\"position:relative;\"><a href=\"#-nginx-%EC%84%A4%EC%B9%98\" aria-label=\" nginx ì„¤ì¹˜ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ Nginx ì„¤ì¹˜</h2>\n<p>NginxëŠ” ëŒ€í‘œì ì¸ ì›¹ ì„œë²„ ì¤‘ í•˜ë‚˜ë¡œ, ê°€ë³ê³  ë†’ì€ ì„±ëŠ¥ìœ¼ë¡œ ë§ì€ ì—”ì§€ë‹ˆì–´ë“¤ì˜ ì‚¬ë‘(?)ì„ ë°›ê³  ìˆë‹¤.\nìƒìš© ì†”ë£¨ì…˜ ë¿ ì•„ë‹ˆë¼ ì˜¤í”ˆ ì†ŒìŠ¤ì¡°ì°¨ êµ‰ì¥íˆ ì„±ëŠ¥ì´ ìš°ìˆ˜í•˜ê³ , í•„ìš” ê¸°ëŠ¥ì€ ê³µê°œëœ ëª¨ë“ˆì„ í†µí•´ì„œ ì‰½ê²Œ ì»¤ìŠ¤í…€ì´ ê°€ëŠ¥í•˜ê¸° ë–„ë¬¸ì— ì—…ê³„ í‘œì¤€ìœ¼ë¡œ ìë¦¬ì¡ì•˜ë‹¤.</p>\n<h3 id=\"ë¡œì»¬í™˜ê²½-ì„¤ì¹˜\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EC%BB%AC%ED%99%98%EA%B2%BD-%EC%84%A4%EC%B9%98\" aria-label=\"ë¡œì»¬í™˜ê²½ ì„¤ì¹˜ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë¡œì»¬í™˜ê²½ ì„¤ì¹˜</h3>\n<p>ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ Dockerë¡œ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜ ë° êµ¬ë™ ê°€ëŠ¥í•˜ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ docker run --rm -p <span class=\"token number\">8080</span>:80 nginx</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>ë‹¤ìŒê³¼ ê°™ì´ docker-composeë¡œ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜ ë° êµ¬ë™í•  ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">pwd</span>\n/Users/jay/Workspace/jay-prometheus/src/\n\n$ docker compose up -d nginx\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Running <span class=\"token number\">2</span>/2\nâ ¿ Network ch04_default  Created                                                                                                                                                                                                   <span class=\"token number\">0</span>.3s\nâ ¿ Container nginx       Started</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"ì„œë²„-ì„¤ì¹˜\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98\" aria-label=\"ì„œë²„ ì„¤ì¹˜ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì„œë²„ ì„¤ì¹˜</h3>\n<p>ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜ ë° êµ¬ë™ì´ ê°€ëŠ¥í•˜ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token comment\"># í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜</span>\n$ <span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> -y yum-utils\n\n<span class=\"token comment\"># nginx íŒ¨í‚¤ì§€ ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/yum.repos.d/nginx.repo <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF\n[nginx-stable]\nname=nginx stable repo\nbaseurl=http://nginx.org/packages/centos/\\<span class=\"token variable\">$releasever</span>/\\<span class=\"token variable\">$basearch</span>/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n\n[nginx-mainline]\nname=nginx mainline repo\nbaseurl=http://nginx.org/packages/mainline/centos/\\<span class=\"token variable\">$releasever</span>/\\<span class=\"token variable\">$basearch</span>/\ngpgcheck=1\nenabled=0\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOF</span>\n\n<span class=\"token comment\"># nginx ë ˆí¬ì§€í† ë¦¬ ì„ íƒ</span>\n$ <span class=\"token function\">sudo</span> yum-config-manager --enable nginx-stable\n\n<span class=\"token comment\"># nginx ì„¤ì¹˜</span>\n$ <span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> -y nginx\n\n<span class=\"token comment\"># nginx êµ¬ë™</span>\n$ <span class=\"token function\">sudo</span> systemctl restart nginx\n\n<span class=\"token comment\"># nginx êµ¬ë™ ìƒíƒœ í™•ì¸</span>\n$ <span class=\"token function\">sudo</span> systemctl status nginx\nâ— nginx.service - nginx - high performance web server\nLoaded: loaded <span class=\"token punctuation\">(</span>/usr/lib/systemd/system/nginx.service<span class=\"token punctuation\">;</span> disabled<span class=\"token punctuation\">;</span> vendor preset: dis<span class=\"token operator\">></span>\nActive: active <span class=\"token punctuation\">(</span>running<span class=\"token punctuation\">)</span> since Thu <span class=\"token number\">2021</span>-07-22 02:20:48 UTC<span class=\"token punctuation\">;</span> 4s ago\nDocs: http://nginx.org/en/docs/\nProcess: <span class=\"token number\">2037</span> <span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/usr/sbin/nginx -c /etc/nginx/nginx.conf <span class=\"token punctuation\">(</span>code<span class=\"token operator\">=</span>exited, statu<span class=\"token operator\">></span>\n<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"ì„¤ì¹˜-ê²°ê³¼\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98-%EA%B2%B0%EA%B3%BC\" aria-label=\"ì„¤ì¹˜ ê²°ê³¼ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì„¤ì¹˜ ê²°ê³¼</h3>\n<p>ê·¸ í›„ í„°ë¯¸ë„ì— ë‹¤ìŒì„ ì…ë ¥í•˜ë©´ ë‹¤ìŒ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token comment\"># ë¡œì»¬ì˜ ê²½ìš°</span>\n$ <span class=\"token function\">curl</span> localhost:8080\n\n<span class=\"token comment\"># ì„œë²„ì˜ ê²½ìš°</span>\n$ <span class=\"token function\">curl</span> localhost\n\n<span class=\"token comment\"># ê²°ê³¼ ì¶œë ¥</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>DOCTYPE html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span>Welcome to nginx<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span>/title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>style<span class=\"token operator\">></span>\n    body <span class=\"token punctuation\">{</span>\n        width: 35em<span class=\"token punctuation\">;</span>\n        margin: <span class=\"token number\">0</span> auto<span class=\"token punctuation\">;</span>\n        font-family: Tahoma, Verdana, Arial, sans-serif<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span>/style<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/head<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>Welcome to nginx<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span>/h<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>\n<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.<span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>For online documentation and support please refer to\n<span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\"http://nginx.org/\"</span><span class=\"token operator\">></span>nginx.org<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span>.<span class=\"token operator\">&lt;</span>br/<span class=\"token operator\">></span>\nCommercial support is available at\n<span class=\"token operator\">&lt;</span>a <span class=\"token assign-left variable\">href</span><span class=\"token operator\">=</span><span class=\"token string\">\"http://nginx.com/\"</span><span class=\"token operator\">></span>nginx.com<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span>.<span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>em<span class=\"token operator\">></span>Thank you <span class=\"token keyword\">for</span> using nginx.<span class=\"token operator\">&lt;</span>/em<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/html<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<h2 id=\"-nginx-prometheus-exporter-ì„¤ì¹˜\" style=\"position:relative;\"><a href=\"#-nginx-prometheus-exporter-%EC%84%A4%EC%B9%98\" aria-label=\" nginx prometheus exporter ì„¤ì¹˜ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>â° nginx-prometheus-exporter ì„¤ì¹˜</h2>\n<p>ì›¹ ì„œë²„ë¥¼ ëª¨ë‹ˆí„°ë§í•  ë•Œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°ë˜ëŠ” ì§€í‘œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. (ë¬¼ë¡  ë” ë§ì„ ìˆ˜ ìˆë‹¤.)</p>\n<ul>\n<li>Connection ê°œìˆ˜</li>\n<li>Connection ìƒíƒœ</li>\n</ul>\n<p><code class=\"language-text\">Nginx</code>ì˜ <code class=\"language-text\">stub_status</code> ëª¨ë“ˆì„ í™œì„±í™”ì‹œí‚¤ë©´ ì´ëŸ° ì»¤ë„¥ì…˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.\nì˜¤í”ˆ ì†ŒìŠ¤ì—ëŠ” ë³¼ ìˆ˜ ìˆëŠ” ì§€í‘œê°€ ì ì§€ë§Œ, ìƒìš© ë²„ì „ì—ëŠ” ê½¤ ë§ì€ ì§€í‘œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. </p>\n<p>í•˜ì§€ë§Œ ëª¨ë“ˆì„ í™œì„±í™”ì‹œì¼°ë‹¤ê³  í•´ì„œ, ì»¤ë„¥ì…˜ì— ëŒ€í•œ ë©”íŠ¸ë¦­ì´ ìë™ì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.\nì´ë¥¼ ìœ„í•´ì„œ <code class=\"language-text\">Nginx</code> ì¬ë‹¨ì€ <code class=\"language-text\">nginx-prometheus-exporter</code>ë¼ëŠ” ê²ƒì„ ë§Œë“¤ê³  ì˜¤í”ˆ ì†ŒìŠ¤ë¡œ ë°°í¬í•´ë‘ì—ˆë‹¤.\nìš°ë¦¬ëŠ” <code class=\"language-text\">Nginx</code> ì›¹ ì„œë²„ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê¸° ìœ„í•´ì„œ ì´ <code class=\"language-text\">Exporter</code>ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.</p>\n<p>ë¨¼ì € ë¡œì»¬ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•˜ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ docker pull nginx/nginx-prometheus-exporter:latest</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><code class=\"language-text\">Nginx</code>ì˜ <code class=\"language-text\">stub_status</code> ëª¨ë“ˆì´ í™œì„±í™” ë˜ì–´ì•¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.</p>\n<h3 id=\"ë¡œì»¬í™˜ê²½-ì„¤ì¹˜-1\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EC%BB%AC%ED%99%98%EA%B2%BD-%EC%84%A4%EC%B9%98-1\" aria-label=\"ë¡œì»¬í™˜ê²½ ì„¤ì¹˜ 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë¡œì»¬í™˜ê²½ ì„¤ì¹˜</h3>\n<p>ì—­ì‹œ ì´ ì¥ì˜ ì½”ë“œë¥¼ ë‹¤ìš´ ë°›ì•˜ë‹¤ë©´, ë‹¤ìŒê³¼ ê°™ì´ <code class=\"language-text\">docker-compose</code>ë¡œ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜ ë° êµ¬ë™í•  ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">pwd</span>\n/Users/gurumee/Workspace/gurumee-book-prometheus/src/part2/ch06\n\n$ docker compose up -d nginx-prometheus-exporter\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Running <span class=\"token number\">1</span>/1\nâ ¿ Container nginx-prometheus-exporter  Started</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"ì„œë²„-ì„¤ì¹˜-1\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98-1\" aria-label=\"ì„œë²„ ì„¤ì¹˜ 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì„œë²„ ì„¤ì¹˜</h3>\n<p>ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token comment\"># ë””ë ‰í† ë¦¬ ìƒì„±</span>\n$ <span class=\"token function\">mkdir</span> -p ~/apps/nginx-prometheus-exporter\n\n<span class=\"token comment\"># ì••ì¶• íŒŒì¼ ë‹¤ìš´ë¡œë“œ</span>\n$ <span class=\"token function\">wget</span> https://github.com/nginxinc/nginx-prometheus-exporter/releases/download/v0.9.0/nginx-prometheus-exporter_0.9.0_linux_amd64.tar.gz\n\n<span class=\"token comment\"># ì••ì¶• íŒŒì¼ í•´ì œ ë° ê²½ë¡œ ì§€ì •</span>\n$ <span class=\"token function\">tar</span> xvf nginx-prometheus-exporter_0.9.0_linux_amd64.tar.gz -C ~/apps/nginx-prometheus-exporter\n\n<span class=\"token comment\"># ì••ì¶• íŒŒì¼ ì‚­ì œ</span>\n$ <span class=\"token function\">rm</span> nginx-prometheus-exporter_0.9.0_linux_amd64.tar.gz\n\n<span class=\"token comment\"># ê²½ë¡œ ì´ë™</span>\n$ <span class=\"token builtin class-name\">cd</span> ~/apps/nginx-prometheus-exporter\n\n<span class=\"token comment\"># nginx-prometheus-exporter ì‹¤í–‰</span>\n$ ./nginx-prometheus-exporter\n<span class=\"token number\">2021</span>/07/22 <span class=\"token number\">10</span>:05:50 Starting NGINX Prometheus Exporter <span class=\"token assign-left variable\">version</span><span class=\"token operator\">=</span><span class=\"token number\">0.9</span>.0 <span class=\"token assign-left variable\">commit</span><span class=\"token operator\">=</span>5f88afbd906baae02edfbab4f5715e06d88538a0 <span class=\"token assign-left variable\">date</span><span class=\"token operator\">=</span><span class=\"token number\">2021</span>-03-22T20:16:09Z\n<span class=\"token number\">2021</span>/07/22 <span class=\"token number\">10</span>:05:50 Could not create Nginx Client: failed to get http://127.0.0.1:8080/stub_status: Get <span class=\"token string\">\"http://127.0.0.1:8080/stub_status\"</span><span class=\"token builtin class-name\">:</span> dial tcp <span class=\"token number\">127.0</span>.0.1:8080: connect:\nconnection refused</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ì—­ì‹œ êµ¬ë™ì€ ë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ì œ ì‰½ê²Œ êµ¬ë™í•˜ê¸° ìœ„í•´ì„œ ì„œë¹„ìŠ¤ íŒŒì¼ë¡œ ë“±ë¡í•´ë³´ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">pwd</span>\n/home/sidelineowl/apps/nginx-prometheus-exporter\n\n<span class=\"token comment\"># user ì¶”ê°€</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">useradd</span> -M -r -s /bin/false nginx_prometheus_exporter\n\n<span class=\"token comment\"># ì‹¤í–‰ íŒŒì¼ /usr/local/bin/ìœ¼ë¡œ ê²½ë¡œ ì´ë™</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> ./nginx-prometheus-exporter /usr/local/bin\n\n<span class=\"token comment\"># /usr/local/bin/nginx-prometheus-exporter nginx_prometheus_exporter ìœ ì €, ê·¸ë£¹ ê¶Œí•œ ì£¼ê¸°</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> nginx_prometheus_exporter:nginx_prometheus_exporter /usr/local/bin/nginx-prometheus-exporter\n\n<span class=\"token comment\"># ì„œë¹„ìŠ¤ íŒŒì¼ ë“±ë¡</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/systemd/system/nginx_prometheus_exporter.service <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF\n[Unit]\nDescription=Nginx Prometheus Exporter\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=nginx_prometheus_exporter\nGroup=nginx_prometheus_exporter\nType=simple\nExecStart=/usr/local/bin/nginx-prometheus-exporter -nginx.scrape-uri http://localhost/metrics\n\n[Install]\nWantedBy=multi-user.target\nEOF</span>\n\n<span class=\"token comment\"># ë°ëª¬ ë¦¬ë¡œë“œ</span>\n<span class=\"token comment\"># sudo systemctl daemon-reload</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"ì‹¤í–‰\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89\" aria-label=\"ì‹¤í–‰ permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì‹¤í–‰</h3>\n<p>ì´ì œ ì„œë¹„ìŠ¤ êµ¬ë™ì„ í•´ë³´ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token comment\"># ì„œë¹„ìŠ¤ êµ¬ë™</span>\n$ <span class=\"token function\">sudo</span> systemctl restart nginx_prometheus_exporter\n\n<span class=\"token comment\"># ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸</span>\n$ <span class=\"token function\">sudo</span> systemctl status nginx_prometheus_exporter\nâ— nginx_prometheus_exporter.service - Nginx Prometheus Exporter\nLoaded: loaded <span class=\"token punctuation\">(</span>/etc/systemd/system/nginx_prometheus_exporter.service<span class=\"token punctuation\">;</span> disabled<span class=\"token punctuation\">;</span> vendor preset: disabled<span class=\"token punctuation\">)</span>\nActive: failed <span class=\"token punctuation\">(</span>Result: exit-code<span class=\"token punctuation\">)</span> since Thu <span class=\"token number\">2021</span>-07-22 <span class=\"token number\">10</span>:12:10 UTC<span class=\"token punctuation\">;</span> 21s ago\nProcess: <span class=\"token number\">4110</span> <span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/usr/local/bin/nginx-prometheus-exporter -nginx.scrape-uri http://localhost/metrics <span class=\"token punctuation\">(</span>code<span class=\"token operator\">=</span>exited, <span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>/FAILURE<span class=\"token punctuation\">)</span>\nMain PID: <span class=\"token number\">4110</span> <span class=\"token punctuation\">(</span>code<span class=\"token operator\">=</span>exited, <span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>/FAILURE<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">-nginx.scrape-url</code>ë¡œ ì„¤ì •í•œ ì—”ë“œí¬ì¸íŠ¸ì— <code class=\"language-text\">stub_status</code> ëª¨ë“ˆì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ì„œ ì—­ì‹œ êµ¬ë™ì€ ì•ˆëœë‹¤.\nì—¬ê¸°ê¹Œì§€ ì™”ìœ¼ë©´ ì„±ê³µì´ë‹¤.</p>\n<hr>\n<h2 id=\"-ë©”íŠ¸ë¦­-ìˆ˜ì§‘ì„-ìœ„í•œ-ê°-ì»´í¬ë„ŒíŠ¸-ì„¤ì •\" style=\"position:relative;\"><a href=\"#-%EB%A9%94%ED%8A%B8%EB%A6%AD-%EC%88%98%EC%A7%91%EC%9D%84-%EC%9C%84%ED%95%9C-%EA%B0%81-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%84%A4%EC%A0%95\" aria-label=\" ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì„ ìœ„í•œ ê° ì»´í¬ë„ŒíŠ¸ ì„¤ì • permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ® ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì„ ìœ„í•œ ê° ì»´í¬ë„ŒíŠ¸ ì„¤ì •</h2>\n<p>ì´ì œ <code class=\"language-text\">Nginx</code>ì˜ <code class=\"language-text\">stub_status</code> ëª¨ë“ˆì„ í™œì„±í™”ì‹œí‚¨ë‹¤.\n<code class=\"language-text\">/metrics</code> ì—”ë“œí¬ì¸íŠ¸ì— ì´ ëª¨ë“ˆì´ ìˆ˜ì§‘í•˜ëŠ” ë©”íŠ¸ë¦­ì„ ë…¸ì¶œì‹œí‚¬ ê²ƒì´ë‹¤.</p>\n<p><code class=\"language-text\">Nginx</code> ì„¤ì • íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.\nì„œë²„ í™˜ê²½ì—ì„œëŠ” <code class=\"language-text\">/etc/nginx/nginx.conf</code>ë¥¼ ìˆ˜ì •í•˜ë©´ ëœë‹¤.\n(ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” <code class=\"language-text\">docker compose</code>ë¡œ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬ë™ë§Œ í•˜ë©´ ëœë‹¤.)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">user  nginx<span class=\"token punctuation\">;</span>\nworker_processes  <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\nerror_log  /var/log/nginx/error.log warn<span class=\"token punctuation\">;</span>\npid        /var/run/nginx.pid<span class=\"token punctuation\">;</span>\n\n\nevents <span class=\"token punctuation\">{</span>\nworker_connections  <span class=\"token number\">1024</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nhttp <span class=\"token punctuation\">{</span>\ninclude       /etc/nginx/mime.types<span class=\"token punctuation\">;</span>\ndefault_type  application/octet-stream<span class=\"token punctuation\">;</span>\n\n    log_format  main  <span class=\"token string\">'$remote_addr - $remote_user [$time_local] \"$request\" '</span>\n                      <span class=\"token string\">'$status $body_bytes_sent \"$http_referer\" '</span>\n                      <span class=\"token string\">'\"$http_user_agent\" \"$http_x_forwarded_for\"'</span><span class=\"token punctuation\">;</span>\n\n    access_log  /var/log/nginx/access.log  main<span class=\"token punctuation\">;</span>\n    sendfile        on<span class=\"token punctuation\">;</span>\n    keepalive_timeout  <span class=\"token number\">65</span><span class=\"token punctuation\">;</span>\n\n    server <span class=\"token punctuation\">{</span>\n        listen <span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\n        proxy_set_header     X-Scope-OrgID docker-ha<span class=\"token punctuation\">;</span>\n\n         location / <span class=\"token punctuation\">{</span>\n            root   /usr/share/nginx/html<span class=\"token punctuation\">;</span>\n            index  index.html index.htm<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\"># stub_status ëª¨ë“ˆ í™œì„±</span>\n        location /metrics <span class=\"token punctuation\">{</span>\n            stub_status on<span class=\"token punctuation\">;</span>\n            access_log off<span class=\"token punctuation\">;</span>\n            allow all<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ê·¸ë¦¬ê³  <code class=\"language-text\">Nginx</code>ë¥¼ ì¬ê°€ë™í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> systemctl restart nginx</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>ì´ì œ <code class=\"language-text\">curl</code>ë¡œ í•œ ë²ˆ í™•ì¸ì„ í•´ë³´ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> localhost/metrics\nActive connections: <span class=\"token number\">1</span>\nserver accepts handled requests\n<span class=\"token number\">1</span> <span class=\"token number\">1</span> <span class=\"token number\">1</span>\nReading: <span class=\"token number\">0</span> Writing: <span class=\"token number\">1</span> Waiting: <span class=\"token number\">0</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ì´ë ‡ê²Œ ë‚˜ì˜¤ë©´ ì„±ê³µì´ë‹¤. <code class=\"language-text\">nginx-prometheus-exporter</code> ì„œë¹„ìŠ¤ë¥¼ ì¬êµ¬ë™í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> systemctl restart nginx_prometheus_exporter</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>ê·¸ í›„ <code class=\"language-text\">curl</code>ë¡œ ë©”íŠ¸ë¦­ì´ ìˆ˜ì§‘ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">curl</span> localhost:9113/metrics\n<span class=\"token comment\"># HELP nginx_connections_accepted Accepted client connections</span>\n<span class=\"token comment\"># TYPE nginx_connections_accepted counter</span>\nnginx_connections_accepted <span class=\"token number\">2</span>\n<span class=\"token comment\"># HELP nginx_connections_active Active client connections</span>\n<span class=\"token comment\"># TYPE nginx_connections_active gauge</span>\nnginx_connections_active <span class=\"token number\">1</span>\n<span class=\"token comment\"># HELP nginx_connections_handled Handled client connections</span>\n<span class=\"token comment\"># TYPE nginx_connections_handled counter</span>\nnginx_connections_handled <span class=\"token number\">2</span>\n<span class=\"token comment\"># HELP nginx_connections_reading Connections where NGINX is reading the request header</span>\n<span class=\"token comment\"># TYPE nginx_connections_reading gauge</span>\nnginx_connections_reading <span class=\"token number\">0</span>\n<span class=\"token comment\"># HELP nginx_connections_waiting Idle client connections</span>\n<span class=\"token comment\"># TYPE nginx_connections_waiting gauge</span>\nnginx_connections_waiting <span class=\"token number\">0</span>\n<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ì´ì œ <code class=\"language-text\">Prometheus</code> ì„¤ì • íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.\nì„œë²„ì—ì„œë¼ë©´ <code class=\"language-text\">/etc/prometheus/prometheus.yml</code>ì— ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token comment\"># my global config</span>\nglobal:\nscrape_interval:     15s <span class=\"token comment\"># By default, scrape targets every 15 seconds.</span>\nevaluation_interval: 15s <span class=\"token comment\"># By default, scrape targets every 15 seconds.</span>\n\nexternal_labels:\nmonitor: <span class=\"token string\">'my-project'</span>\n\nrule_files:\n\nscrape_configs:\n<span class=\"token comment\"># ...</span>\n\n- job_name: <span class=\"token string\">'nginx-prometheus-exporter'</span>\n  scrape_interval: 5s\n\n  static_configs:\n  <span class=\"token comment\"># nginxì™€ nginx-prometheus-exporterê°€ ì„¤ì¹˜ëœ IP:9113</span>\n    - targets: <span class=\"token punctuation\">[</span><span class=\"token string\">'nginx-prometheus-exporter:9113'</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ê·¸ë¦¬ê³  <code class=\"language-text\">Prometheus</code>ë¥¼ ì¬êµ¬ë™í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> systemctl restart prometheus</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>ê·¸ í›„ <code class=\"language-text\">Prometheus UI</code>ì—ì„œ ë‹¤ìŒì„ ì¿¼ë¦¬í•´ë³´ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">nginx_up</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì˜¤ë©´ ì„±ê³µì´ë‹¤.</p>\n<p><img src=\"https://user-images.githubusercontent.com/55419159/146771916-cd54be72-5e84-4f35-b5ec-233c47e827c2.png\" alt=\"image\"></p>\n<hr>\n<h2 id=\"-grafana-ëŒ€ì‹œë³´ë“œ-êµ¬ì¶•\" style=\"position:relative;\"><a href=\"#-grafana-%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C-%EA%B5%AC%EC%B6%95\" aria-label=\" grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶• permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ“¯ Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</h2>\n<p>ì´ì œ ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì¶•í•œë‹¤. ë‹¤ìŒ JSON íŒŒì¼ì„ ë³µì‚¬í•´ì„œ ëŒ€ì‹œë³´ë“œë¥¼ ì„í¬íŠ¸í•œë‹¤. (ë¡œì»¬ í™˜ê²½ì—ëŠ” ì´ë¯¸ ëŒ€ì‹œë³´ë“œê°€ ë¡œë“œë˜ì–´ ìˆë‹¤.)\n<a href=\"https://grafana.com/grafana/dashboards/9614\">ë‹¤ìŒ ë§í¬</a>ë¡œ ê°€ì„œ JSON íŒŒì¼ì„ ë³µì‚¬í•œë‹¤.</p>\n<p><img src=\"https://user-images.githubusercontent.com/55419159/146773163-8fd10949-e114-4128-8cb4-79d4eb8689df.png\" alt=\"image\"></p>\n<p>ë‹¤ìŒê³¼ ê°™ì€ ì§€í‘œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>\n<ul>\n<li><code class=\"language-text\">Nginx</code> êµ¬ë™ ìƒíƒœ</li>\n<li><code class=\"language-text\">Nginx Connection</code> ìƒíƒœ</li>\n<li><code class=\"language-text\">Nginx Connection</code> ê°œìˆ˜</li>\n<li><code class=\"language-text\">Nginx</code> ì´ˆë‹¹ ìš”ì²­ ê°œìˆ˜</li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/category/monitoring/nginx-prometheus/#-%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0-%EC%A0%84%EC%97%90\">â›³ ë“¤ì–´ê°€ê¸° ì „ì—..</a></p>\n<ul>\n<li><a href=\"/category/monitoring/nginx-prometheus/#-%EC%83%81%ED%99%A9\">ğŸ•¹ ìƒí™©</a></li>\n<li>\n<p><a href=\"/category/monitoring/nginx-prometheus/#%EF%B8%8F-%EA%B8%B0%EC%88%A0\">âš™ï¸ ê¸°ìˆ </a></p>\n<ul>\n<li><a href=\"/category/monitoring/nginx-prometheus/#data-source\">Data Source</a></li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#prometheus\">Prometheus</a></li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#grafana\">Grafana</a></li>\n</ul>\n</li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#-%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8\">ğŸ¨ ë‹¤ì´ì–´ê·¸ë¨</a></li>\n</ul>\n</li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#-%EA%B0%9C%EC%9A%94\">ğŸ•¹ ê°œìš”</a></li>\n<li>\n<p><a href=\"/category/monitoring/nginx-prometheus/#-nginx-%EC%84%A4%EC%B9%98\">ğŸ Nginx ì„¤ì¹˜</a></p>\n<ul>\n<li><a href=\"/category/monitoring/nginx-prometheus/#%EB%A1%9C%EC%BB%AC%ED%99%98%EA%B2%BD-%EC%84%A4%EC%B9%98\">ë¡œì»¬í™˜ê²½ ì„¤ì¹˜</a></li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98\">ì„œë²„ ì„¤ì¹˜</a></li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#%EC%84%A4%EC%B9%98-%EA%B2%B0%EA%B3%BC\">ì„¤ì¹˜ ê²°ê³¼</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/monitoring/nginx-prometheus/#-nginx-prometheus-exporter-%EC%84%A4%EC%B9%98\">â° nginx-prometheus-exporter ì„¤ì¹˜</a></p>\n<ul>\n<li><a href=\"/category/monitoring/nginx-prometheus/#%EB%A1%9C%EC%BB%AC%ED%99%98%EA%B2%BD-%EC%84%A4%EC%B9%98-1\">ë¡œì»¬í™˜ê²½ ì„¤ì¹˜</a></li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98-1\">ì„œë²„ ì„¤ì¹˜</a></li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#%EC%8B%A4%ED%96%89\">ì‹¤í–‰</a></li>\n</ul>\n</li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#-%EB%A9%94%ED%8A%B8%EB%A6%AD-%EC%88%98%EC%A7%91%EC%9D%84-%EC%9C%84%ED%95%9C-%EA%B0%81-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%84%A4%EC%A0%95\">ğŸ® ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì„ ìœ„í•œ ê° ì»´í¬ë„ŒíŠ¸ ì„¤ì •</a></li>\n<li><a href=\"/category/monitoring/nginx-prometheus/#-grafana-%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C-%EA%B5%AC%EC%B6%95\">ğŸ“¯ Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</a></li>\n</ul>","frontmatter":{"title":"[ëª¨ë‹ˆí„°ë§] Nginx ë¥¼ Prometheus ë¡œ ëª¨ë‹ˆí„°ë§ í•˜ê¸°","description":"","date":"2021.12.20","emoji":"ğŸš‚","category":"monitoring"}}},"pageContext":{"slug":"/category/monitoring/nginx-prometheus/","relatedPosts":[{"node":{"fields":{"slug":"/category/monitoring/oauth2-openid/"},"frontmatter":{"title":"[ëª¨ë‹ˆí„°ë§] Oauth 2.0ê³¼ OpenID Connect í”„ë¡œí† ì½œ ì •ë¦¬","date":"2022.01.29","emoji":"ğŸ”’","category":"monitoring"}}},{"node":{"fields":{"slug":"/category/monitoring/jenkins-plugins/"},"frontmatter":{"title":"[ëª¨ë‹ˆí„°ë§] íì‡ ë§ì—ì„œ Jenkins ì—…ê·¸ë ˆì´ë“œ & í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜í•˜ê¸°","date":"2022.01.25","emoji":"ğŸ•´","category":"monitoring"}}},{"node":{"fields":{"slug":"/category/monitoring/fluentd-prometheus/"},"frontmatter":{"title":"[ëª¨ë‹ˆí„°ë§] Fluentd ë¥¼ Prometheus ë¡œ ëª¨ë‹ˆí„°ë§ í•˜ê¸°","date":"2021.12.17","emoji":"ğŸ”¡","category":"monitoring"}}},{"node":{"fields":{"slug":"/category/monitoring/about-kafka/"},"frontmatter":{"title":"[ëª¨ë‹ˆí„°ë§] Kafka ë€","date":"2021.11.28","emoji":"ğŸ“¨","category":"monitoring"}}}]}},"staticQueryHashes":["196006245","1984257895","2528810007"]}