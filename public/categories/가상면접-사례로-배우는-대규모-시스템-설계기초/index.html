<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Category: 가상면접 사례로 배우는 대규모 시스템 설계기초 - Jay&#039;s Develop Note</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Jay&#039;s Develop Note"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Jay&#039;s Develop Note"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="기억보단 기록으로"><meta property="og:type" content="blog"><meta property="og:title" content="Jay&#039;s Develop Note"><meta property="og:url" content="http://won0935.github.io/"><meta property="og:site_name" content="Jay&#039;s Develop Note"><meta property="og:description" content="기억보단 기록으로"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://won0935.github.io/img/og_image.png"><meta property="article:author" content="Song Jae-won, Jay"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://won0935.github.io"},"headline":"Jay's Develop Note","image":["http://won0935.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Song Jae-won, Jay"},"publisher":{"@type":"Organization","name":"Jay's Develop Note","logo":{"@type":"ImageObject","url":{"text":"기억보단 기록으로"}}},"description":"기억보단 기록으로"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">기억보단 기록으로</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" target="_blank" rel="noopener" href="https://dev-song.notion.site/Clean-Neat-Code-955801f71953414097b2992b1ed9f3b2">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/won0935"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li class="is-active"><a href="#" aria-current="page">가상면접 사례로 배우는 대규모 시스템 설계기초</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-01T00:25:46.204Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-01T00:25:46.204Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item"><a class="link-muted" href="/categories/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/">가상면접 사례로 배우는 대규모 시스템 설계기초</a></span><span class="level-item">3 minutes read (About 502 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/01/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/2021-10-13-%ED%82%A4-%EA%B0%92-%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%84%A4%EA%B3%84/2021-10-13-%ED%82%A4-%EA%B0%92-%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%84%A4%EA%B3%84/">키-값 저장소 설계</a></h1><div class="content"><blockquote>
<ul>
<li>비 관계형 데이터베이스<br>고유식별자(key)를 키로 가짐</li>
<li>키와 값 사이의 연결 관계를 “키-값” 쌍(pair)라고 표현</li>
</ul>
</blockquote>
<hr>
<h2 id="분산-키-값-저장소의-CAP-정리"><a href="#분산-키-값-저장소의-CAP-정리" class="headerlink" title="분산 키-값 저장소의 CAP 정리"></a>분산 키-값 저장소의 CAP 정리</h2><p>데이터 일관성(Consistency), 가용성(Availability), 파티션 감내성(Partition Tolerance)라 표현하며,<br>동시에 3가지 요구사항을 만족하는 것은 불가능하다는 정리</p>
<p><img src="https://user-images.githubusercontent.com/55419159/138880667-4a4e727b-07d8-44e0-99b5-14088750a4b2.png" alt="image">{: .image-center}</p>
<hr>
<h3 id="용어-정리"><a href="#용어-정리" class="headerlink" title="용어 정리"></a>용어 정리</h3><p>데이터 일관성(Consistency)</p>
<ul>
<li>분산 시스템에 접속하는 모든 클라이언트는 어떤 노드에 접속했느냐에 관계 없이 언제나 같은 데이터를 보게 되어야 한다.</li>
</ul>
<p>가용성(Availability)</p>
<ul>
<li>분산 시스템에 접속하는 클라이언트는 일부 노드에 장애가 발생하더라도 항상 응답을 받을 수 있어야 한다.</li>
</ul>
<p>파티션 감내성(Partition Tolerance)</p>
<ul>
<li>파티션은 두 노드 사이에 통신 장애가 발생하였음을 의미한다. 파티션 감내는 네트워크에 파티션이 생기더라도 시스템은 계속 동작하여야 한다는 것을 뜻한다.</li>
</ul>
<hr>
<h3 id="분산-키-값-저장소가-가져야하는-기능"><a href="#분산-키-값-저장소가-가져야하는-기능" class="headerlink" title="분산 키-값 저장소가 가져야하는 기능"></a>분산 키-값 저장소가 가져야하는 기능</h3><table>
<thead>
<tr>
<th>목표/문제</th>
<th>기술</th>
</tr>
</thead>
<tbody><tr>
<td>대규모 데이터 저장</td>
<td>안정 해시를 사용해 서버들에 부하 분산</td>
</tr>
<tr>
<td>읽기 연산에 대한 높은 가용성 보장</td>
<td>여러 데이터센터에 다중화</td>
</tr>
<tr>
<td>쓰기 연산에 대한 높은 가용성 보장</td>
<td>버저닝 및 벡터 시계를 사용한 충돌 해소</td>
</tr>
<tr>
<td>데이터 파티션</td>
<td>안정 해시</td>
</tr>
<tr>
<td>점진적 규모 확장성</td>
<td>안정 해시</td>
</tr>
<tr>
<td>다양성(heterogeneity)</td>
<td>안정 해시</td>
</tr>
<tr>
<td>조절 가능한 데이터 일관성</td>
<td>정족수 합의</td>
</tr>
<tr>
<td>일시적 장애 처리</td>
<td>느슨한 정족수 프로토콜과 단서 후 임시 위탁</td>
</tr>
<tr>
<td>영구적 장애 처리</td>
<td>머클 트리</td>
</tr>
<tr>
<td>데이터 센터 장애 대응</td>
<td>여러 데이터 센터에 걸친 데이터 다중화</td>
</tr>
</tbody></table>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-01T00:25:46.203Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-01T00:25:46.203Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item"><a class="link-muted" href="/categories/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/">가상면접 사례로 배우는 대규모 시스템 설계기초</a></span><span class="level-item">7 minutes read (About 996 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/01/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/2021-10-13-%EC%B2%98%EB%A6%AC%EC%9C%A8-%EC%A0%9C%ED%95%9C-%EC%9E%A5%EC%B9%98%EC%9D%98-%EC%84%A4%EA%B3%84/2021-10-13-%EC%B2%98%EB%A6%AC%EC%9C%A8-%EC%A0%9C%ED%95%9C-%EC%9E%A5%EC%B9%98%EC%9D%98-%EC%84%A4%EA%B3%84/">처리율 제한 장치의 설계</a></h1><div class="content"><h1 id="처리율-제한-장치의-설계"><a href="#처리율-제한-장치의-설계" class="headerlink" title="처리율 제한 장치의 설계"></a>처리율 제한 장치의 설계</h1><blockquote>
<p>API 요청횟수가 특정 임계치를 넘어가면 추가로 도달한 요청은 처리를 중단하는 것</p>
</blockquote>
<hr>
<h2 id="장점"><a href="#장점" class="headerlink" title="장점"></a>장점</h2><ol>
<li>DoS공격 방지</li>
<li>비용절감</li>
<li>서버 과부하 방지</li>
</ol>
<hr>
<h1 id="처리율-제한-알고리즘"><a href="#처리율-제한-알고리즘" class="headerlink" title="처리율 제한 알고리즘"></a>처리율 제한 알고리즘</h1><h2 id="토큰-버킷"><a href="#토큰-버킷" class="headerlink" title="토큰 버킷"></a>토큰 버킷</h2><pre><code>&gt; 토큰을 발급하고 토큰의 갯수 만큼만 API 요청을 버킷에 담음
버킷이 가득 찬 경우 API요청은 버려짐(overflow)
&gt;
</code></pre>
<p><img src="https://user-images.githubusercontent.com/55419159/138881073-2532be82-cc51-4872-a6be-f7e256b1a74e.png" alt="image"></p>
<pre><code>- 가장 간단하고 폭넓게 사용됨(아마존 등)
- 메모리 효율성 높음
- 버킷크기:토큰공급률 비율 튜닝이 관건
</code></pre>
<hr>
<h2 id="누출-버킷"><a href="#누출-버킷" class="headerlink" title="누출 버킷"></a>누출 버킷</h2><pre><code>&gt; 토큰 버킷 알고리즘과 유사하지만 처리율이 고정
큐(FIFO)로 구현
&gt; 
</code></pre>
<p><img src="https://user-images.githubusercontent.com/55419159/138881283-90475661-ca10-481f-a3fb-2e7e3cae0168.png" alt="image"></p>
<ul>
<li>동작방식<ol>
<li>요청이 도착하면 큐가 가득 차 있는지 확인, 빈자리가 있는 경우 큐에 요청 추가</li>
<li>큐가 가득 차있는 경우 새 요청은 버림</li>
<li>지정된 시간마다 큐에서 요청을 꺼내어 처리</li>
</ol>
<ul>
<li>토큰 버킷 알고리즘과 유사</li>
<li>고정된 처리율을 가지고 있어 안정적 출력이 필요한 환경에 적합</li>
<li>단시간에 많은 처리율이 들어올 경우 취약함</li>
</ul>
</li>
</ul>
<hr>
<h2 id="고정-윈도-카운터"><a href="#고정-윈도-카운터" class="headerlink" title="고정 윈도 카운터"></a>고정 윈도 카운터</h2><ul>
<li>동작방식<ol>
<li>타임라인을 고정된 간격의 윈도로 나누고, 각 윈도마다 카운터를 붙임</li>
<li>요청이 접수될 때마다 이 카운터의 값은 1씩 증가함</li>
<li>이 카운터 값이 사전에 설정된 임계치에 도달하면 새로운 요청은<br>새 윈도가 열릴 때 까지 버려짐</li>
</ol>
</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/55419159/138881425-aaf0ecc3-a73c-4007-9d36-3c9693f2062f.png" alt="image"></p>
<pre><code>- 메모리 효율 좋음
- 윈도 경계에서 일시적으로 많은 트래픽이 몰려드는 경우, 
기대했던 시스템의 처리 한도보다 많은 양의 요청을 처리하게 됨
</code></pre>
<hr>
<h2 id="이동-윈도-로그"><a href="#이동-윈도-로그" class="headerlink" title="이동 윈도 로그"></a>이동 윈도 로그</h2><pre><code>&gt; 고정 윈도 카운터 알고리즘의 윈도 경계 부분에서 
트래픽이 몰리는 경우를 보완하기 위한 알고리즘
&gt; 
</code></pre>
<ul>
<li>동작방식<ol>
<li>요청의 타임스탬프를 추적함<br>타임스탬프는 보통 Redis의 Sorted Set과 같은 정렬 집합 캐시에 보관</li>
<li>새 요청이 오면 만료된 타임스탬프는 제거</li>
<li>새 요청의 타임 스탬프를 로그에 추가</li>
<li>로그의 크기가 허용치보다 같거나 작으면 요청을 시스템에 전달함<br>그렇지 않은 경우 처리는 거부됨</li>
</ol>
<ul>
<li>윈도 알고리즘의 처리율 한도를 넘지 않음</li>
<li>다량의 메모리 사용, 거부된 요청의 타임스탬프도 보관하기 때문</li>
</ul>
</li>
</ul>
<hr>
<h2 id="이동-윈도-카운터"><a href="#이동-윈도-카운터" class="headerlink" title="이동 윈도 카운터"></a>이동 윈도 카운터</h2><pre><code>&gt; 고정 윈도 카운터 + 이동 윈도 로그
&gt; 

- 이전 시간대의 평균 처리율에 따라 현재 윈도의 상태를 계산하므로 
짧은 시간에 몰리는 트래픽에도 잘 대응
- 메모리 효율이 좋음
- 직전 시간의 추정치를 계산하기 때문에 기준이 느슨함, But 심각한 건 아님
</code></pre>
<hr>
<h1 id="프로세스"><a href="#프로세스" class="headerlink" title="프로세스"></a>프로세스</h1><ol>
<li>처리율 제한 규칙은 디스크에 보관한다.<br>작업 프로세스는 수시로 규칙을 디스크에서 읽어 캐시에 저장한다.</li>
<li>클라이언트가 요청을 서버에 보내면 요청은 먼저 처리율 제한 미들웨어에 도달한다.<br>카운터 및 마지막 요청의 타임스탬프를 레디스 캐시에서 가져온다. <ul>
<li>해당 요청이 처리율 제한에 걸리지 않은 경우 API서버로 보낸다.</li>
<li>해당 요청이 처리율 제한에 걸렸다면 429(too many request) 에러를 클라이언트에 보낸다.<br>한편 해당 요청은 그대로 버릴 수도 있고 메시지 큐에 저장할 수도 있다.</li>
</ul>
</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item"><a class="link-muted" href="/categories/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/">가상면접 사례로 배우는 대규모 시스템 설계기초</a></span><span class="level-item">2 minutes read (About 351 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/01/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/2021-10-13-%EA%B0%9C%EB%9E%B5%EC%A0%81%EC%9D%B8-%EA%B7%9C%EB%AA%A8-%EC%B6%94%EC%A0%95/2021-10-13-%EA%B0%9C%EB%9E%B5%EC%A0%81%EC%9D%B8-%EA%B7%9C%EB%AA%A8-%EC%B6%94%EC%A0%95/">개략적인 규모 추정</a></h1><div class="content"><h1 id="2의-제곱-수"><a href="#2의-제곱-수" class="headerlink" title="2의 제곱 수"></a>2의 제곱 수</h1><ul>
<li>최소단위는 1바이트, 8비트</li>
<li>아스키 문자 하나 메모리크기가 1바이트</li>
</ul>
<h1 id="모든-프로그래머가-알아야-하는-응답-지연-값"><a href="#모든-프로그래머가-알아야-하는-응답-지연-값" class="headerlink" title="모든 프로그래머가 알아야 하는 응답 지연 값"></a>모든 프로그래머가 알아야 하는 응답 지연 값</h1><ul>
<li>메모리는 빠르지만 디스크는 아직도 느리다</li>
<li>디스크 탐색은 가능한 한 피하라</li>
<li>단순한 압축 알고리즘은 빠르다</li>
<li>데이터를 인터넷으로 전송하기 전에 가능하면 압축하라</li>
<li>데이터 센터는 보통 여러 지역에 분산되어있고, 센터들 간에 데이터를 주고 받는 데는 시간이 걸린다</li>
</ul>
<h1 id="가용성에-관계된-수치들"><a href="#가용성에-관계된-수치들" class="headerlink" title="가용성에 관계된 수치들"></a>가용성에 관계된 수치들</h1><blockquote>
<p>고가용성</p>
<p>시스템이 오랜 기간동안 지속적으로 중단 없이 운영될 수 있는 능력</p>
</blockquote>
<hr>
<h1 id="예제-트위터-QPS와-저장소-요구량-추정"><a href="#예제-트위터-QPS와-저장소-요구량-추정" class="headerlink" title="예제: 트위터 QPS와 저장소 요구량 추정"></a>예제: 트위터 QPS와 저장소 요구량 추정</h1><h2 id="가정"><a href="#가정" class="headerlink" title="가정"></a>가정</h2><ul>
<li>월간 능동 사용자(mau) 3억 명</li>
<li>50%가 매일 사용</li>
<li>각 사용자는 매일 2건</li>
<li>미디어 포함 10%</li>
<li>데이터는 5년 보관</li>
</ul>
<h2 id="추정"><a href="#추정" class="headerlink" title="추정"></a>추정</h2><ul>
<li>QPS(Query Per Second) 추정치</li>
<li>일간 능동 사용자(dau) = 3억 x 50% = 1.5억</li>
<li>QPS = 1.5억 x 2건 / 24시간 / 3600초 = 약 3500</li>
<li>최대 QPS = 2 x QPS = 약 7000</li>
</ul>
<h2 id="미디어-저장을-위한-저장소-요구량"><a href="#미디어-저장을-위한-저장소-요구량" class="headerlink" title="미디어 저장을 위한 저장소 요구량"></a>미디어 저장을 위한 저장소 요구량</h2><ul>
<li>평균 크기<ul>
<li>id = 64바이트</li>
<li>body = 140바이트</li>
<li>미디어 = 1MB</li>
</ul>
</li>
<li>미디어 저장소 요구량 : 1.5억 x 2 x 10% x 1MB = 30TB/day</li>
<li>5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB x 365 x 5 = 약 55PB</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item"><a class="link-muted" href="/categories/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/">가상면접 사례로 배우는 대규모 시스템 설계기초</a></span><span class="level-item">5 minutes read (About 707 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/01/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/2021-10-13-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%88%98%EC%97%90-%EB%94%B0%EB%A5%B8-%EA%B7%9C%EB%AA%A8-%ED%99%95%EC%9E%A5%EC%84%B1/2021-10-13-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%88%98%EC%97%90-%EB%94%B0%EB%A5%B8-%EA%B7%9C%EB%AA%A8-%ED%99%95%EC%9E%A5%EC%84%B1/">사용자 수에 따른 규모 확장성</a></h1><div class="content"><ul>
<li>요약<ul>
<li>웹 계층은 무상태 계층으로</li>
<li>모든 계층에 다중화 도입</li>
<li>가능한 많은 데이터를 캐시할 것</li>
<li>여러 데이터 센터를 지원할 것</li>
<li>정적 콘텐츠는 CDN을 통해 서비스할 것</li>
<li>데이터 계층은 샤딩을 통에 그 규모를 확장할 것</li>
<li>각 계층은 독립적 서비스로 분할할 것</li>
<li>시스템을 지속적으로 모니터링 하고, 자동화 도구들을 활용할 것</li>
</ul>
</li>
</ul>
<hr>
<h1 id="단일서버"><a href="#단일서버" class="headerlink" title="단일서버"></a>단일서버</h1><h2 id="시스템이-단일-서버로-구현되어있다고-가정할-시-프로세스"><a href="#시스템이-단일-서버로-구현되어있다고-가정할-시-프로세스" class="headerlink" title="시스템이 단일 서버로 구현되어있다고 가정할 시 프로세스"></a>시스템이 단일 서버로 구현되어있다고 가정할 시 프로세스</h2><ol>
<li>사용자가 도메인(api.mysite.com)으로 접속한다.</li>
<li>DNS에 질의하여 IP주소로 반환된다. (DNS는 제3사업자임)</li>
<li>IP주소로 HTTP 요청</li>
<li>HTML or Json으로 응답</li>
</ol>
<hr>
<h1 id="데이터베이스"><a href="#데이터베이스" class="headerlink" title="데이터베이스"></a>데이터베이스</h1><h2 id="RDBMS-vs-NoSQL"><a href="#RDBMS-vs-NoSQL" class="headerlink" title="RDBMS vs NoSQL"></a>RDBMS vs NoSQL</h2><ul>
<li>RDBMS<ul>
<li>오라클, MySQL, PostegreSQL</li>
<li>열, 컬럼으로 표현</li>
<li>Join으로 합침</li>
</ul>
</li>
<li>NoSQL<ul>
<li>MongoDB …</li>
<li>Join 지원 안함</li>
</ul>
</li>
</ul>
<h2 id="NoSQL-쓰는-경우"><a href="#NoSQL-쓰는-경우" class="headerlink" title="NoSQL 쓰는 경우"></a>NoSQL 쓰는 경우</h2><ul>
<li>속도 중요할 시</li>
<li>비정형 데이터일 시</li>
<li>데이터 직렬화, 역직렬화 용</li>
<li>대량의 데이터</li>
</ul>
<hr>
<h1 id="수직적-규모-확장-vs-수평적-규모-확장"><a href="#수직적-규모-확장-vs-수평적-규모-확장" class="headerlink" title="수직적 규모 확장 vs 수평적 규모 확장"></a>수직적 규모 확장 vs 수평적 규모 확장</h1><h2 id="Sacale-Up-vs-Sacale-Out"><a href="#Sacale-Up-vs-Sacale-Out" class="headerlink" title="Sacale-Up vs Sacale-Out"></a>Sacale-Up vs Sacale-Out</h2><p>Scale-Up : 단일 서버 사양을 높임</p>
<p>Scale-Out : 서버 수를 추가</p>
<h2 id="Sacale-Up-아닌-Sacale-Out이-유리한-이유"><a href="#Sacale-Up-아닌-Sacale-Out이-유리한-이유" class="headerlink" title="Sacale-Up 아닌 Sacale-Out이 유리한 이유"></a>Sacale-Up 아닌 Sacale-Out이 유리한 이유</h2><ul>
<li>한 대의 서버 메모리를 무한대로 증설할 방법이 없음</li>
<li>장애에 대한 자동복구 방안이나 다중화 제시 X</li>
</ul>
<h2 id="로드밸런서-LB"><a href="#로드밸런서-LB" class="headerlink" title="로드밸런서(LB)"></a>로드밸런서(LB)</h2><ul>
<li>트래픽 분산의 역할</li>
</ul>
<h2 id="DB-다중화"><a href="#DB-다중화" class="headerlink" title="DB 다중화"></a>DB 다중화</h2><ul>
<li>이중화 시 master-slave로 나눔</li>
<li>master는 write, slave는 read</li>
<li>보통 read연산 비중이 훨씬 높고 slave DB가 더 많음 → 성능</li>
</ul>
<hr>
<h1 id="캐시"><a href="#캐시" class="headerlink" title="캐시"></a>캐시</h1><ul>
<li>값비싼 연산 결과나 자주 참조되는 데이터를 저장하는 메모리</li>
</ul>
<h2 id="캐시-사용-시-고려해야-할-것"><a href="#캐시-사용-시-고려해야-할-것" class="headerlink" title="캐시 사용 시 고려해야 할 것"></a>캐시 사용 시 고려해야 할 것</h2><ul>
<li>영속적인 데이터 X</li>
<li>만료(expire) 방식<ul>
<li>LRU → 가장 자주 씀</li>
<li>LFU</li>
<li>FIFO</li>
</ul>
</li>
<li>데이터 일관성 유지 방식</li>
</ul>
<hr>
<h1 id="콘텐츠-전송-네크워크-CDN"><a href="#콘텐츠-전송-네크워크-CDN" class="headerlink" title="콘텐츠 전송 네크워크(CDN)"></a>콘텐츠 전송 네크워크(CDN)</h1><ul>
<li>정적 콘텐츠 캐싱</li>
<li>CSS, JS, 이미지, 비디오</li>
</ul>
<hr>
<h1 id="무상태-stateless-웹-계층"><a href="#무상태-stateless-웹-계층" class="headerlink" title="무상태(stateless) 웹 계층"></a>무상태(stateless) 웹 계층</h1><ul>
<li>Scale-Out 시 중요</li>
<li>상태정보를 웹 계층에서 제거</li>
</ul>
<h2 id="상태-정보를-웹-말고-DB에-저장"><a href="#상태-정보를-웹-말고-DB에-저장" class="headerlink" title="상태 정보를 웹 말고 DB에 저장"></a>상태 정보를 웹 말고 DB에 저장</h2><ul>
<li>MSA시 <strong>공유저장소</strong>를 활용</li>
<li>Redis, NoSQL 활용</li>
</ul>
<hr>
<h1 id="데이터센터"><a href="#데이터센터" class="headerlink" title="데이터센터"></a>데이터센터</h1><ul>
<li>통상적으로 지리적으로 가장 가까운 곳으로 라우팅(Geo-routing)</li>
</ul>
<h2 id="구축-시-신경써야-할-것"><a href="#구축-시-신경써야-할-것" class="headerlink" title="구축 시 신경써야 할 것"></a>구축 시 신경써야 할 것</h2><ul>
<li>트래픽 우회</li>
<li>데이터 동기화</li>
<li>테스트와 배포</li>
</ul>
<p>→ Message Queue는 시스템이 독립적으로 확장할 수 있는 핵심전략</p>
<hr>
<h1 id="메시지-큐"><a href="#메시지-큐" class="headerlink" title="메시지 큐"></a>메시지 큐</h1><ul>
<li>무손실, 비동기</li>
<li>pub-sub 방식</li>
</ul>
<hr>
<h1 id="데이터베이스의-규모-확장"><a href="#데이터베이스의-규모-확장" class="headerlink" title="데이터베이스의 규모 확장"></a>데이터베이스의 규모 확장</h1><h2 id="샤딩-sharding"><a href="#샤딩-sharding" class="headerlink" title="샤딩(sharding)"></a>샤딩(sharding)</h2><ul>
<li>DB를 scale-out 하는 것</li>
<li><strong>모든 샤드는 같은 스키마를 쓰지만 데이터 중복은 없음</strong></li>
<li>샤딩 키를 정하는 것이 중요</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item"><a class="link-muted" href="/categories/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/">가상면접 사례로 배우는 대규모 시스템 설계기초</a></span><span class="level-item">2 minutes read (About 344 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/01/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/2021-10-13-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84-%EB%A9%B4%EC%A0%91-%EA%B3%B5%EB%9E%B5%EB%B2%95/2021-10-13-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84-%EB%A9%B4%EC%A0%91-%EA%B3%B5%EB%9E%B5%EB%B2%95/">시스템 설계 면접 공략법</a></h1><div class="content"><h1 id="효과적-면접을-위한-4단계-접근법"><a href="#효과적-면접을-위한-4단계-접근법" class="headerlink" title="효과적 면접을 위한 4단계 접근법"></a>효과적 면접을 위한 4단계 접근법</h1><h2 id="1-문제-이해-및-설계-범위-확정"><a href="#1-문제-이해-및-설계-범위-확정" class="headerlink" title="1. 문제 이해 및 설계 범위 확정"></a>1. 문제 이해 및 설계 범위 확정</h2><ul>
<li>구체적으로 어떤 기능들을 만들어야 하나</li>
<li>제품 사용자 수는 얼마나 되나</li>
<li>회사의 규모는 얼마나 빨리 커지리라 예상하나? 석 달, 여섯 달, 일년 뒤의 규모는 얼마가 되리라 예상하는가</li>
<li>회사가 주로 사용하는 기술 스택은 무엇인가</li>
<li>설계를 단순화 하기 위한 기존 서비스로는 어떤 것이 있는가</li>
</ul>
<p>→ 중요한 것은 모호함을 없에는 것</p>
<hr>
<h2 id="2-개략적인-설계안-제시-및-동의-구하기"><a href="#2-개략적인-설계안-제시-및-동의-구하기" class="headerlink" title="2. 개략적인 설계안 제시 및 동의 구하기"></a>2. 개략적인 설계안 제시 및 동의 구하기</h2><ul>
<li>청사진을 만들고 의견을 구하라ㅋ</li>
<li>화이트보드에 다이어그램 그리기<ul>
<li>클라이언트, API, 웹서버, DB, 캐시, CDN, MQ 등</li>
</ul>
</li>
<li>청사진이 제약사항에 부합하는지 확인하라</li>
</ul>
<hr>
<h2 id="3-상세-설계"><a href="#3-상세-설계" class="headerlink" title="3. 상세 설계"></a>3. 상세 설계</h2><ul>
<li>시스템에서 전반적으로 달성해야 할 목표와 기능 범위 확인</li>
<li>전체 설계의 개략적 청사진 마련</li>
<li>해당 청사진에 대한 면접관의 의견 청취</li>
<li>상세 설계에서 집중해야 할 영역들 확인</li>
</ul>
<hr>
<h2 id="4-마무리"><a href="#4-마무리" class="headerlink" title="4. 마무리"></a>4. 마무리</h2><ul>
<li>개선점 찾기 ex&gt; 병목구간</li>
<li>설계 핵심 요약</li>
<li>운영 관련 이슈<ul>
<li>메트릭, 모니터링, 로그, 배포 등</li>
</ul>
</li>
<li>시스템 확장 방식</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-01T00:25:46.202Z" title="11/1/2021, 9:25:46 AM">2021-11-01</time></span><span class="level-item"><a class="link-muted" href="/categories/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/">가상면접 사례로 배우는 대규모 시스템 설계기초</a></span><span class="level-item">3 minutes read (About 385 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/01/%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84%EA%B8%B0%EC%B4%88/2021-10-13-%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C-%EC%84%A4%EA%B3%84/2021-10-13-%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C-%EC%84%A4%EA%B3%84/">안정 해시 설계</a></h1><div class="content"><blockquote>
<p>수평적 규모 확장을 위해서는 요청 또는 데이터를 서버로 균등하게 나누는 것이 중요<br>안정 해시는 이 목표를 달성하기 위해 보편적으로 사용하는 기술</p>
</blockquote>
<hr>
<h2 id="안정-해시-설계의-이점"><a href="#안정-해시-설계의-이점" class="headerlink" title="안정 해시 설계의  이점"></a>안정 해시 설계의  이점</h2><ul>
<li>서버가 추가되거나 삭제될 때 재배치되는 키의 수가 최소화된다.</li>
<li>데이터가 보다 균등하게 분포하게 되므로 수평적 규모 확장성을 달성하기 쉽다.</li>
<li>핫스팟(hotspot) 키 문제를 줄인다.</li>
</ul>
<hr>
<h3 id="만약-잘-분배가-되어있던-서버-하나가-죽었을-경우"><a href="#만약-잘-분배가-되어있던-서버-하나가-죽었을-경우" class="headerlink" title="만약 잘 분배가 되어있던 서버 하나가 죽었을 경우?"></a>만약 잘 분배가 되어있던 서버 하나가 죽었을 경우?</h3><h3 id="기존-해시-테이블"><a href="#기존-해시-테이블" class="headerlink" title="기존 해시 테이블"></a>기존 해시 테이블</h3><ul>
<li>모든 키를 재배치함</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/55419159/138881514-e09e12fd-2764-40ee-9eef-2cf3a4a84f3f.png"></p>
<h3 id="안정-해시"><a href="#안정-해시" class="headerlink" title="안정 해시"></a>안정 해시</h3><ul>
<li>이상이 있는 부분만 재배치</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/55419159/138881565-e60403c1-c98e-48ab-bb80-8a8c5f10320b.png"></p>
<hr>
<h2 id="기본-구현법"><a href="#기본-구현법" class="headerlink" title="기본 구현법"></a>기본 구현법</h2><ol>
<li>서버와 키를 균등 분포 해시 함수를 사용해 해시 링에 배치한다.</li>
<li>키의 위치에서 링을 시계 방향을 탐색하다 만나는 최초의 서버가 키가 저장될 서버다.</li>
</ol>
<p><strong>문제점</strong></p>
<ul>
<li>서버가 추가되거나 삭제될 때 파티션의 크기를 균등하게 유지하는게 불가능</li>
<li>키의 균등 분포를 달성하기가 어려움</li>
</ul>
<hr>
<h2 id="가상-노드"><a href="#가상-노드" class="headerlink" title="가상 노드"></a>가상 노드</h2><blockquote>
<p>기본 구현법의 문제를 해결하기 위한 방법<br>실제 노드를 가르키는 가상 노드를 만들어 해시 링에 균등하게 배치하는 방법</p>
</blockquote>
</div></article></div></div><!--!--><div class="column column-right  order-3 is-sticky"><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">기억보단 기록으로</a><p class="is-size-7"><span>&copy; 2021 Song Jae-won, Jay</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/won0935"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>