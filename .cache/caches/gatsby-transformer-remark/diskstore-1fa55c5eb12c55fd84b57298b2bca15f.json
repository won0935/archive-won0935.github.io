{"expireTime":9007200896353687000,"key":"transformer-remark-markdown-ast-b4d61831e0ab8f8dbeb45681effbcdc0-gatsby-remark-code-titlesgatsby-remark-embed-youtubegatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-custom-blocksgatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":{"type":"root","children":[{"type":"heading","depth":2,"children":[{"type":"link","url":"#개요","title":null,"children":[],"data":{"hProperties":{"aria-label":"개요 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"개요","position":{"start":{"line":2,"column":4,"offset":4},"end":{"line":2,"column":6,"offset":6},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":6,"offset":6},"indent":[]},"data":{"id":"개요","htmlAttributes":{"id":"개요"},"hProperties":{"id":"개요","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"5장에서는 지금까지 만든 DAO에 트랜잭션을 적용해보면서 스프링이 어떻게 비슷한 여러 종류의 기술을 추상화하며 일관된 방법으로 기술을 사용할 수 있도록 지원하는지를 살펴볼 예정 !","position":{"start":{"line":4,"column":1,"offset":8},"end":{"line":4,"column":101,"offset":108},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":8},"end":{"line":4,"column":101,"offset":108},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#5-1-비즈니스-로직","title":null,"children":[],"data":{"hProperties":{"aria-label":"5 1 비즈니스 로직 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"5-1. 비즈니스 로직","position":{"start":{"line":6,"column":4,"offset":113},"end":{"line":6,"column":16,"offset":125},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":110},"end":{"line":6,"column":16,"offset":125},"indent":[]},"data":{"id":"5-1-비즈니스-로직","htmlAttributes":{"id":"5-1-비즈니스-로직"},"hProperties":{"id":"5-1-비즈니스-로직","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"5-1장에서는 다음과 같은 새로운 비즈니스 로직(Service)을 추가합니다.","position":{"start":{"line":8,"column":1,"offset":127},"end":{"line":8,"column":44,"offset":170},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":127},"end":{"line":8,"column":44,"offset":170},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"사용자의 레벨은 ","position":{"start":{"line":10,"column":4,"offset":175},"end":{"line":10,"column":13,"offset":184},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">BASIC</code>","position":{"start":{"line":10,"column":13,"offset":184},"end":{"line":10,"column":20,"offset":191},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":10,"column":20,"offset":191},"end":{"line":10,"column":22,"offset":193},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">SILVER</code>","position":{"start":{"line":10,"column":22,"offset":193},"end":{"line":10,"column":30,"offset":201},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":10,"column":30,"offset":201},"end":{"line":10,"column":32,"offset":203},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">GOLD</code>","position":{"start":{"line":10,"column":32,"offset":203},"end":{"line":10,"column":38,"offset":209},"indent":[]}},{"type":"text","value":" 세 가지 중 하나다.","position":{"start":{"line":10,"column":38,"offset":209},"end":{"line":10,"column":50,"offset":221},"indent":[]}}],"position":{"start":{"line":10,"column":4,"offset":175},"end":{"line":10,"column":50,"offset":221},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":172},"end":{"line":10,"column":50,"offset":221},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"사용자가 처음 가입하면 ","position":{"start":{"line":11,"column":4,"offset":225},"end":{"line":11,"column":17,"offset":238},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">BASIC</code>","position":{"start":{"line":11,"column":17,"offset":238},"end":{"line":11,"column":24,"offset":245},"indent":[]}},{"type":"text","value":", 이후 활동에 따라서 단계가 업그레이드","position":{"start":{"line":11,"column":24,"offset":245},"end":{"line":11,"column":46,"offset":267},"indent":[]}}],"position":{"start":{"line":11,"column":4,"offset":225},"end":{"line":11,"column":46,"offset":267},"indent":[]}}],"position":{"start":{"line":11,"column":1,"offset":222},"end":{"line":11,"column":46,"offset":267},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"가입 후 50회 이상 로그인시 ","position":{"start":{"line":12,"column":4,"offset":271},"end":{"line":12,"column":21,"offset":288},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">BASIC -> SILVER</code>","position":{"start":{"line":12,"column":21,"offset":288},"end":{"line":12,"column":38,"offset":305},"indent":[]}}],"position":{"start":{"line":12,"column":4,"offset":271},"end":{"line":12,"column":38,"offset":305},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":268},"end":{"line":12,"column":38,"offset":305},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">SILVER</code>","position":{"start":{"line":13,"column":4,"offset":309},"end":{"line":13,"column":12,"offset":317},"indent":[]}},{"type":"text","value":"이면서 30번 이상 추천받으면 ","position":{"start":{"line":13,"column":12,"offset":317},"end":{"line":13,"column":29,"offset":334},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">GOLD</code>","position":{"start":{"line":13,"column":29,"offset":334},"end":{"line":13,"column":35,"offset":340},"indent":[]}},{"type":"text","value":"로 업그레이드","position":{"start":{"line":13,"column":35,"offset":340},"end":{"line":13,"column":42,"offset":347},"indent":[]}}],"position":{"start":{"line":13,"column":4,"offset":309},"end":{"line":13,"column":42,"offset":347},"indent":[]}}],"position":{"start":{"line":13,"column":1,"offset":306},"end":{"line":13,"column":42,"offset":347},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"사용자 레벨 변경 작업은 일정한 주기를 가지고 일괄적으로 적용된다.","position":{"start":{"line":14,"column":4,"offset":351},"end":{"line":14,"column":41,"offset":388},"indent":[]}}],"position":{"start":{"line":14,"column":4,"offset":351},"end":{"line":14,"column":41,"offset":388},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":348},"end":{"line":14,"column":41,"offset":388},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":172},"end":{"line":14,"column":41,"offset":388},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"위의 기능을 메소드화 없이, 한 곳에 로직을 몰아서 구현하면 ?!","position":{"start":{"line":16,"column":3,"offset":392},"end":{"line":16,"column":39,"offset":428},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":390},"end":{"line":16,"column":41,"offset":430},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":390},"end":{"line":16,"column":41,"offset":430},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">UserService.java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// 전체 유저 조회 후 레벨 업그레이드 판단</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Boolean</span> changed <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Level</span> level <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 현재 레벨</span>\n        <span class=\"token keyword\">int</span> login <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 로그인 수</span>\n        <span class=\"token keyword\">int</span> recommend <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getRecommend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 추천 수</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>level <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>BASIC <span class=\"token operator\">&amp;&amp;</span> login <span class=\"token operator\">>=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            changed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>level <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER <span class=\"token operator\">&amp;&amp;</span> recommend <span class=\"token operator\">>=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>GOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            changed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>level <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>GOLD<span class=\"token punctuation\">)</span> changed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span> changed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>changed<span class=\"token punctuation\">)</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":18,"column":1,"offset":432},"end":{"line":40,"column":4,"offset":1162},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"코드를 보면 이 코드가 무엇을 하는지 정확히 알기 어렵습니다.","position":{"start":{"line":42,"column":1,"offset":1164},"end":{"line":42,"column":35,"offset":1198},"indent":[]}},{"type":"break","position":{"start":{"line":42,"column":35,"offset":1198},"end":{"line":43,"column":1,"offset":1201},"indent":[1]}},{"type":"html","value":"<code class=\"language-text\">for-loop</code>","position":{"start":{"line":43,"column":1,"offset":1201},"end":{"line":43,"column":11,"offset":1211},"indent":[]}},{"type":"text","value":" 속에 들어있는 ","position":{"start":{"line":43,"column":11,"offset":1211},"end":{"line":43,"column":20,"offset":1220},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">if/elseif/else</code>","position":{"start":{"line":43,"column":20,"offset":1220},"end":{"line":43,"column":36,"offset":1236},"indent":[]}},{"type":"text","value":" 블록들과 플래그를 두고 확인하는 작업은 깔끔해보이지 않습니다.","position":{"start":{"line":43,"column":36,"offset":1236},"end":{"line":43,"column":71,"offset":1271},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":1164},"end":{"line":43,"column":71,"offset":1271},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"따라서, 작성된 코드를 살펴볼 때는 다음과 같은 질문을 해볼 필요가 있습니다.","position":{"start":{"line":45,"column":1,"offset":1273},"end":{"line":45,"column":44,"offset":1316},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":1273},"end":{"line":45,"column":44,"offset":1316},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"코드에 중복된 부분은 없는지?","position":{"start":{"line":47,"column":4,"offset":1321},"end":{"line":47,"column":20,"offset":1337},"indent":[]}}],"position":{"start":{"line":47,"column":4,"offset":1321},"end":{"line":47,"column":20,"offset":1337},"indent":[]}}],"position":{"start":{"line":47,"column":1,"offset":1318},"end":{"line":47,"column":20,"offset":1337},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"코드가 무엇을 하는 것인지 단번에 알 수 있는지?","position":{"start":{"line":48,"column":4,"offset":1341},"end":{"line":48,"column":31,"offset":1368},"indent":[]}}],"position":{"start":{"line":48,"column":4,"offset":1341},"end":{"line":48,"column":31,"offset":1368},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":1338},"end":{"line":48,"column":31,"offset":1368},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"코드가 자신이 있어야 할 자리에 있는지?","position":{"start":{"line":49,"column":4,"offset":1372},"end":{"line":49,"column":26,"offset":1394},"indent":[]}}],"position":{"start":{"line":49,"column":4,"offset":1372},"end":{"line":49,"column":26,"offset":1394},"indent":[]}}],"position":{"start":{"line":49,"column":1,"offset":1369},"end":{"line":49,"column":26,"offset":1394},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"변경이 일어난다면, 그 변화에 쉽게 대응할 수 있도록 작성되어 있는지?","position":{"start":{"line":50,"column":4,"offset":1398},"end":{"line":50,"column":43,"offset":1437},"indent":[]}}],"position":{"start":{"line":50,"column":4,"offset":1398},"end":{"line":50,"column":43,"offset":1437},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":1395},"end":{"line":50,"column":43,"offset":1437},"indent":[]}}],"position":{"start":{"line":47,"column":1,"offset":1318},"end":{"line":50,"column":43,"offset":1437},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"이번 5-1장의 핵심은 위와 같은 질문을 가지고 코드를 리팩토링하는 것입니다.","position":{"start":{"line":52,"column":1,"offset":1439},"end":{"line":52,"column":44,"offset":1482},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":1439},"end":{"line":52,"column":44,"offset":1482},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#무엇을-하는지-단번에-알-수-있도록-리팩토링","title":null,"children":[],"data":{"hProperties":{"aria-label":"무엇을 하는지 단번에 알 수 있도록 리팩토링 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"무엇을 하는지 단번에 알 수 있도록 리팩토링","position":{"start":{"line":54,"column":6,"offset":1489},"end":{"line":54,"column":30,"offset":1513},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":1484},"end":{"line":54,"column":30,"offset":1513},"indent":[]},"data":{"id":"무엇을-하는지-단번에-알-수-있도록-리팩토링","htmlAttributes":{"id":"무엇을-하는지-단번에-알-수-있도록-리팩토링"},"hProperties":{"id":"무엇을-하는지-단번에-알-수-있도록-리팩토링","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"코드의 전체 로직은 다음과 같이 요약이 가능합니다.","position":{"start":{"line":56,"column":1,"offset":1515},"end":{"line":56,"column":29,"offset":1543},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":1515},"end":{"line":56,"column":29,"offset":1543},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"현재 레벨 확인 후 업그레이드 가능한지 알려주는 로직","position":{"start":{"line":58,"column":4,"offset":1548},"end":{"line":58,"column":33,"offset":1577},"indent":[]}}],"position":{"start":{"line":58,"column":4,"offset":1548},"end":{"line":58,"column":33,"offset":1577},"indent":[]}}],"position":{"start":{"line":58,"column":1,"offset":1545},"end":{"line":58,"column":33,"offset":1577},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"다음 레벨 확인, 설정 로직","position":{"start":{"line":59,"column":4,"offset":1581},"end":{"line":59,"column":19,"offset":1596},"indent":[]}}],"position":{"start":{"line":59,"column":4,"offset":1581},"end":{"line":59,"column":19,"offset":1596},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":1578},"end":{"line":59,"column":19,"offset":1596},"indent":[]}}],"position":{"start":{"line":58,"column":1,"offset":1545},"end":{"line":59,"column":19,"offset":1596},"indent":[1]}},{"type":"html","value":"<div class=\"gatsby-code-title\">UserService.java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// 기본 작업 흐름만 남겨둔 메소드</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 1. 현재 레벨 확인 후 업그레이드 가능한지 알려주는 로직</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 2. 다음 레벨 확인, 설정 로직</span>\n            <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":61,"column":1,"offset":1598},"end":{"line":74,"column":4,"offset":1920},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">플래그 설정</code>","position":{"start":{"line":76,"column":1,"offset":1922},"end":{"line":76,"column":9,"offset":1930},"indent":[]}},{"type":"text","value":"과 같은 로직이 들어갈 때, 해당 로직을 메소드로 빼기만 하면 플래그를 매번 확인해 작업을 처리하는 로직을 없앨 수 있습니다.","position":{"start":{"line":76,"column":9,"offset":1930},"end":{"line":76,"column":79,"offset":2000},"indent":[]}}],"position":{"start":{"line":76,"column":1,"offset":1922},"end":{"line":76,"column":79,"offset":2000},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"이제, 해당 메소드가 어떤 작업을 하는지 단번에 이해할 수 있습니다.","position":{"start":{"line":78,"column":1,"offset":2002},"end":{"line":78,"column":39,"offset":2040},"indent":[]}}],"position":{"start":{"line":78,"column":1,"offset":2002},"end":{"line":78,"column":39,"offset":2040},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#숫자의-중복-제거하는-리팩토링","title":null,"children":[],"data":{"hProperties":{"aria-label":"숫자의 중복 제거하는 리팩토링 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"숫자의 중복 제거하는 리팩토링","position":{"start":{"line":80,"column":6,"offset":2047},"end":{"line":80,"column":22,"offset":2063},"indent":[]}}],"position":{"start":{"line":80,"column":1,"offset":2042},"end":{"line":80,"column":22,"offset":2063},"indent":[]},"data":{"id":"숫자의-중복-제거하는-리팩토링","htmlAttributes":{"id":"숫자의-중복-제거하는-리팩토링"},"hProperties":{"id":"숫자의-중복-제거하는-리팩토링","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"업그레이드 가능 확인 로직","position":{"start":{"line":82,"column":3,"offset":2067},"end":{"line":82,"column":17,"offset":2081},"indent":[]}}],"position":{"start":{"line":82,"column":1,"offset":2065},"end":{"line":82,"column":19,"offset":2083},"indent":[]}}],"position":{"start":{"line":82,"column":1,"offset":2065},"end":{"line":82,"column":19,"offset":2083},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">UserService.java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MIN_LOGCOUNT_FOR_SILVER <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MIN_RECOMMEND_FOR_GOLD <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Level</span> currentLevel <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>currentLevel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> BASIC<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> MIN_LOGCOUNT_FOR_SILVER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> SILVER<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getRecommend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> MIN_RECOMMEND_FOR_GOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> GOLD<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unknown Level: \"</span> <span class=\"token operator\">+</span> currentLevel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":84,"column":1,"offset":2085},"end":{"line":103,"column":4,"offset":2676},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"여러 곳에 중복되어 사용되는 것도 중복이지만, 한 가지 변경 이유가 발생했을 때, 여러 곳을 고치게 만드는 것도 중복입니다.","position":{"start":{"line":105,"column":1,"offset":2678},"end":{"line":105,"column":70,"offset":2747},"indent":[]}},{"type":"break","position":{"start":{"line":105,"column":70,"offset":2747},"end":{"line":106,"column":1,"offset":2750},"indent":[1]}},{"type":"text","value":"따라서, 이러한 숫자들은 ","position":{"start":{"line":106,"column":1,"offset":2750},"end":{"line":106,"column":15,"offset":2764},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">상수화</code>","position":{"start":{"line":106,"column":15,"offset":2764},"end":{"line":106,"column":20,"offset":2769},"indent":[]}},{"type":"text","value":" 시켜 사용하는 것이 좋습니다.","position":{"start":{"line":106,"column":20,"offset":2769},"end":{"line":106,"column":37,"offset":2786},"indent":[]}}],"position":{"start":{"line":105,"column":1,"offset":2678},"end":{"line":106,"column":37,"offset":2786},"indent":[1]}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">장점</code>","position":{"start":{"line":108,"column":1,"offset":2788},"end":{"line":108,"column":5,"offset":2792},"indent":[]}},{"type":"text","value":"은 변경이 일어났을 때 ","position":{"start":{"line":108,"column":5,"offset":2792},"end":{"line":108,"column":18,"offset":2805},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">상수값만 하나만 변경</code>","position":{"start":{"line":108,"column":18,"offset":2805},"end":{"line":108,"column":31,"offset":2818},"indent":[]}},{"type":"text","value":"하면 되고, 숫자가 ","position":{"start":{"line":108,"column":31,"offset":2818},"end":{"line":108,"column":42,"offset":2829},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">어떤 의미를 가지는지</code>","position":{"start":{"line":108,"column":42,"offset":2829},"end":{"line":108,"column":55,"offset":2842},"indent":[]}},{"type":"text","value":"도 파악할 수 있어 가독성에 더 좋습니다.","position":{"start":{"line":108,"column":55,"offset":2842},"end":{"line":108,"column":78,"offset":2865},"indent":[]}}],"position":{"start":{"line":108,"column":1,"offset":2788},"end":{"line":108,"column":78,"offset":2865},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#자신이-있어야-할-자리로-옮기는-리팩토링","title":null,"children":[],"data":{"hProperties":{"aria-label":"자신이 있어야 할 자리로 옮기는 리팩토링 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"자신이 있어야 할 자리로 옮기는 리팩토링","position":{"start":{"line":110,"column":6,"offset":2872},"end":{"line":110,"column":28,"offset":2894},"indent":[]}}],"position":{"start":{"line":110,"column":1,"offset":2867},"end":{"line":110,"column":28,"offset":2894},"indent":[]},"data":{"id":"자신이-있어야-할-자리로-옮기는-리팩토링","htmlAttributes":{"id":"자신이-있어야-할-자리로-옮기는-리팩토링"},"hProperties":{"id":"자신이-있어야-할-자리로-옮기는-리팩토링","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"현재 레벨을 파악해 다음 레벨로 업그레이드하는 로직","position":{"start":{"line":112,"column":3,"offset":2898},"end":{"line":112,"column":31,"offset":2926},"indent":[]}}],"position":{"start":{"line":112,"column":1,"offset":2896},"end":{"line":112,"column":33,"offset":2928},"indent":[]}}],"position":{"start":{"line":112,"column":1,"offset":2896},"end":{"line":112,"column":33,"offset":2928},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">UserService.java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>BASIC<span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER<span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>GOLD<span class=\"token punctuation\">)</span>\n    userDao<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":114,"column":1,"offset":2930},"end":{"line":122,"column":4,"offset":3187},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"위 코드의 문제점은 ","position":{"start":{"line":124,"column":1,"offset":3189},"end":{"line":124,"column":12,"offset":3200},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">다음 단계가 무엇인지 확인하는 로직</code>","position":{"start":{"line":124,"column":12,"offset":3200},"end":{"line":124,"column":33,"offset":3221},"indent":[]}},{"type":"text","value":" + ","position":{"start":{"line":124,"column":33,"offset":3221},"end":{"line":124,"column":36,"offset":3224},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">사용자 Level 필드 변경 로직</code>","position":{"start":{"line":124,"column":36,"offset":3224},"end":{"line":124,"column":56,"offset":3244},"indent":[]}},{"type":"text","value":"이 함께 있습니다.","position":{"start":{"line":124,"column":56,"offset":3244},"end":{"line":124,"column":66,"offset":3254},"indent":[]}}],"position":{"start":{"line":124,"column":1,"offset":3189},"end":{"line":124,"column":66,"offset":3254},"indent":[]}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">개선 방법</code>","position":{"start":{"line":126,"column":1,"offset":3256},"end":{"line":126,"column":8,"offset":3263},"indent":[]}},{"type":"text","value":"은 다음 단계가 무엇인지 확인하는 로직을 ","position":{"start":{"line":126,"column":8,"offset":3263},"end":{"line":126,"column":31,"offset":3286},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">UserService</code>","position":{"start":{"line":126,"column":31,"offset":3286},"end":{"line":126,"column":44,"offset":3299},"indent":[]}},{"type":"text","value":"가 아닌 ","position":{"start":{"line":126,"column":44,"offset":3299},"end":{"line":126,"column":49,"offset":3304},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">Level</code>","position":{"start":{"line":126,"column":49,"offset":3304},"end":{"line":126,"column":56,"offset":3311},"indent":[]}},{"type":"text","value":" 객체에서 확인하면 됩니다.","position":{"start":{"line":126,"column":56,"offset":3311},"end":{"line":126,"column":71,"offset":3326},"indent":[]}}],"position":{"start":{"line":126,"column":1,"offset":3256},"end":{"line":126,"column":71,"offset":3326},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Level enum 객체","position":{"start":{"line":128,"column":3,"offset":3330},"end":{"line":128,"column":16,"offset":3343},"indent":[]}}],"position":{"start":{"line":128,"column":1,"offset":3328},"end":{"line":128,"column":18,"offset":3345},"indent":[]}}],"position":{"start":{"line":128,"column":1,"offset":3328},"end":{"line":128,"column":18,"offset":3345},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">Level.java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 다음 단계의 레벨 정보도 함께 추가한다.</span>\n    <span class=\"token function\">GOLD</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">SILVER</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> GOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">BASIC</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> SILVER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token comment\">// getter, setter</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":130,"column":1,"offset":3347},"end":{"line":138,"column":4,"offset":3514},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"User의 레벨 업그레이드 작업용 메소드","position":{"start":{"line":140,"column":3,"offset":3518},"end":{"line":140,"column":25,"offset":3540},"indent":[]}}],"position":{"start":{"line":140,"column":1,"offset":3516},"end":{"line":140,"column":27,"offset":3542},"indent":[]}}],"position":{"start":{"line":140,"column":1,"offset":3516},"end":{"line":140,"column":27,"offset":3542},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">User.java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Level</span> nextLevel <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>level<span class=\"token punctuation\">.</span><span class=\"token function\">nextLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextLevel <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>level <span class=\"token operator\">+</span> <span class=\"token string\">\"은 업그레이드가 불가능합니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>level <span class=\"token operator\">=</span> nextLevel<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":142,"column":1,"offset":3544},"end":{"line":152,"column":4,"offset":3803},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"간결해진 UserService의 ‘upgradeLevel()’","position":{"start":{"line":154,"column":3,"offset":3807},"end":{"line":154,"column":37,"offset":3841},"indent":[]}}],"position":{"start":{"line":154,"column":1,"offset":3805},"end":{"line":154,"column":39,"offset":3843},"indent":[]}}],"position":{"start":{"line":154,"column":1,"offset":3805},"end":{"line":154,"column":39,"offset":3843},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">UserService.java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userDao<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":156,"column":1,"offset":3845},"end":{"line":161,"column":4,"offset":3971},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"이제 작업 내용이 명확하게 드러나고 각자 자기 책임에 충실한 작업만 하고 있어 코드를 이해하기 쉬워졌습니다.","position":{"start":{"line":163,"column":1,"offset":3973},"end":{"line":163,"column":61,"offset":4033},"indent":[]}}],"position":{"start":{"line":163,"column":1,"offset":3973},"end":{"line":163,"column":61,"offset":4033},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#레벨업-정책-추상화","title":null,"children":[],"data":{"hProperties":{"aria-label":"레벨업 정책 추상화 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"레벨업 정책 추상화","position":{"start":{"line":165,"column":6,"offset":4040},"end":{"line":165,"column":16,"offset":4050},"indent":[]}}],"position":{"start":{"line":165,"column":1,"offset":4035},"end":{"line":165,"column":16,"offset":4050},"indent":[]},"data":{"id":"레벨업-정책-추상화","htmlAttributes":{"id":"레벨업-정책-추상화"},"hProperties":{"id":"레벨업-정책-추상화","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"더 개선 해보자면, 다음처럼 ","position":{"start":{"line":167,"column":1,"offset":4052},"end":{"line":167,"column":17,"offset":4068},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">연말 이벤트</code>","position":{"start":{"line":167,"column":17,"offset":4068},"end":{"line":167,"column":25,"offset":4076},"indent":[]}},{"type":"text","value":"나, ","position":{"start":{"line":167,"column":25,"offset":4076},"end":{"line":167,"column":28,"offset":4079},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">새로운 서비스 홍보기간</code>","position":{"start":{"line":167,"column":28,"offset":4079},"end":{"line":167,"column":42,"offset":4093},"indent":[]}},{"type":"text","value":" 중에는 레벨업 정책을 다르게 적용할 수 있도록 추상화하는 것도 생각해 볼 수 있습니다.","position":{"start":{"line":167,"column":42,"offset":4093},"end":{"line":167,"column":91,"offset":4142},"indent":[]}}],"position":{"start":{"line":167,"column":1,"offset":4052},"end":{"line":167,"column":91,"offset":4142},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">Java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserLevelUpgradePolicy</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">boolean</span> <span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":169,"column":1,"offset":4144},"end":{"line":174,"column":4,"offset":4284},"indent":[1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#5-2-트랜잭션에서의-서비스-추상화","title":null,"children":[],"data":{"hProperties":{"aria-label":"5 2 트랜잭션에서의 서비스 추상화 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"5-2. 트랜잭션에서의 서비스 추상화","position":{"start":{"line":176,"column":4,"offset":4289},"end":{"line":176,"column":24,"offset":4309},"indent":[]}}],"position":{"start":{"line":176,"column":1,"offset":4286},"end":{"line":176,"column":24,"offset":4309},"indent":[]},"data":{"id":"5-2-트랜잭션에서의-서비스-추상화","htmlAttributes":{"id":"5-2-트랜잭션에서의-서비스-추상화"},"hProperties":{"id":"5-2-트랜잭션에서의-서비스-추상화","style":"position:relative;"}}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#트랜잭션이란-","title":null,"children":[],"data":{"hProperties":{"aria-label":"트랜잭션이란  permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"트랜잭션이란 ?","position":{"start":{"line":178,"column":6,"offset":4316},"end":{"line":178,"column":14,"offset":4324},"indent":[]}}],"position":{"start":{"line":178,"column":1,"offset":4311},"end":{"line":178,"column":14,"offset":4324},"indent":[]},"data":{"id":"트랜잭션이란-","htmlAttributes":{"id":"트랜잭션이란-"},"hProperties":{"id":"트랜잭션이란-","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"더 이상 나눌 수 없는 단위인 작업을 말합니다.","position":{"start":{"line":180,"column":1,"offset":4326},"end":{"line":180,"column":27,"offset":4352},"indent":[]}}],"position":{"start":{"line":180,"column":1,"offset":4326},"end":{"line":180,"column":27,"offset":4352},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"작업을 쪼개서 작은 단위로 만들 수 없다는 것은 트랜잭션의 핵심 속성인 ","position":{"start":{"line":182,"column":1,"offset":4354},"end":{"line":182,"column":41,"offset":4394},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">원자성</code>","position":{"start":{"line":182,"column":41,"offset":4394},"end":{"line":182,"column":46,"offset":4399},"indent":[]}},{"type":"text","value":"을 의미합니다.","position":{"start":{"line":182,"column":46,"offset":4399},"end":{"line":182,"column":54,"offset":4407},"indent":[]}},{"type":"break","position":{"start":{"line":182,"column":54,"offset":4407},"end":{"line":183,"column":1,"offset":4410},"indent":[1]}},{"type":"text","value":"따라서, 중간에 예외가 발생해서 작업을 완료할 수 없다면 아예 ","position":{"start":{"line":183,"column":1,"offset":4410},"end":{"line":183,"column":36,"offset":4445},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">작업이 시작되지 않던 초기 상태</code>","position":{"start":{"line":183,"column":36,"offset":4445},"end":{"line":183,"column":55,"offset":4464},"indent":[]}},{"type":"text","value":"로 돌려놔야합니다.","position":{"start":{"line":183,"column":55,"offset":4464},"end":{"line":183,"column":65,"offset":4474},"indent":[]}}],"position":{"start":{"line":182,"column":1,"offset":4354},"end":{"line":183,"column":65,"offset":4474},"indent":[1]}},{"type":"infoCustomBlock","children":[{"type":"infoCustomBlockHeading","data":{"hName":"div","hProperties":{"className":"custom-block-heading"}},"children":[{"type":"text","value":"추가) 트랜잭션의 특징 - ACID","position":{"start":{"line":185,"column":1,"offset":4476},"end":{"line":185,"column":20,"offset":4495},"indent":[]}}]},{"type":"infoCustomBlockBody","data":{"hName":"div","hProperties":{"className":"custom-block-body"}},"children":[{"type":"paragraph","children":[{"type":"linkReference","identifier":"1","label":"1","referenceType":"shortcut","children":[{"type":"text","value":"1","position":{"start":{"line":185,"column":2,"offset":4477},"end":{"line":185,"column":3,"offset":4478},"indent":[]}}],"position":{"start":{"line":185,"column":1,"offset":4476},"end":{"line":185,"column":4,"offset":4479},"indent":[]}},{"type":"text","value":" 원자성 ( Atomicity )","position":{"start":{"line":185,"column":4,"offset":4479},"end":{"line":185,"column":22,"offset":4497},"indent":[]}},{"type":"break","position":{"start":{"line":185,"column":22,"offset":4497},"end":{"line":186,"column":1,"offset":4507},"indent":[1]}},{"type":"linkReference","identifier":"2","label":"2","referenceType":"shortcut","children":[{"type":"text","value":"2","position":{"start":{"line":186,"column":2,"offset":4508},"end":{"line":186,"column":3,"offset":4509},"indent":[]}}],"position":{"start":{"line":186,"column":1,"offset":4507},"end":{"line":186,"column":4,"offset":4510},"indent":[]}},{"type":"text","value":" 일관성 ( Consistency )","position":{"start":{"line":186,"column":4,"offset":4510},"end":{"line":186,"column":24,"offset":4530},"indent":[]}},{"type":"break","position":{"start":{"line":186,"column":24,"offset":4530},"end":{"line":187,"column":1,"offset":4533},"indent":[1]}},{"type":"linkReference","identifier":"3","label":"3","referenceType":"shortcut","children":[{"type":"text","value":"3","position":{"start":{"line":187,"column":2,"offset":4534},"end":{"line":187,"column":3,"offset":4535},"indent":[]}}],"position":{"start":{"line":187,"column":1,"offset":4533},"end":{"line":187,"column":4,"offset":4536},"indent":[]}},{"type":"text","value":" 독립성 ( Isolation )","position":{"start":{"line":187,"column":4,"offset":4536},"end":{"line":187,"column":22,"offset":4554},"indent":[]}},{"type":"break","position":{"start":{"line":187,"column":22,"offset":4554},"end":{"line":188,"column":1,"offset":4561},"indent":[1]}},{"type":"linkReference","identifier":"4","label":"4","referenceType":"shortcut","children":[{"type":"text","value":"4","position":{"start":{"line":188,"column":2,"offset":4562},"end":{"line":188,"column":3,"offset":4563},"indent":[]}}],"position":{"start":{"line":188,"column":1,"offset":4561},"end":{"line":188,"column":4,"offset":4564},"indent":[]}},{"type":"text","value":" 지속성 ( Durability )","position":{"start":{"line":188,"column":4,"offset":4564},"end":{"line":188,"column":23,"offset":4583},"indent":[]}}],"position":{"start":{"line":185,"column":1,"offset":4476},"end":{"line":188,"column":23,"offset":4583},"indent":[1,1,1]}}]}],"data":{"hName":"div","hProperties":{"className":["custom-block","info"]}},"position":{"start":{"line":185,"column":1,"offset":4476},"end":{"line":189,"column":25,"offset":4611},"indent":[1,1,1,1]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#트랜잭션-경계-설정","title":null,"children":[],"data":{"hProperties":{"aria-label":"트랜잭션 경계 설정 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"트랜잭션 경계 설정","position":{"start":{"line":191,"column":6,"offset":4618},"end":{"line":191,"column":16,"offset":4628},"indent":[]}}],"position":{"start":{"line":191,"column":1,"offset":4613},"end":{"line":191,"column":16,"offset":4628},"indent":[]},"data":{"id":"트랜잭션-경계-설정","htmlAttributes":{"id":"트랜잭션-경계-설정"},"hProperties":{"id":"트랜잭션-경계-설정","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">DB</code>","position":{"start":{"line":193,"column":1,"offset":4630},"end":{"line":193,"column":5,"offset":4634},"indent":[]}},{"type":"text","value":"는 그 자체로 완벽한 트랜잭션을 지원합니다.","position":{"start":{"line":193,"column":5,"offset":4634},"end":{"line":193,"column":29,"offset":4658},"indent":[]}}],"position":{"start":{"line":193,"column":1,"offset":4630},"end":{"line":193,"column":29,"offset":4658},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"하나의 ","position":{"start":{"line":195,"column":1,"offset":4660},"end":{"line":195,"column":5,"offset":4664},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">SQL</code>","position":{"start":{"line":195,"column":5,"offset":4664},"end":{"line":195,"column":10,"offset":4669},"indent":[]}},{"type":"text","value":" 명령어를 처리하는 경우는 ","position":{"start":{"line":195,"column":10,"offset":4669},"end":{"line":195,"column":25,"offset":4684},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">DB</code>","position":{"start":{"line":195,"column":25,"offset":4684},"end":{"line":195,"column":29,"offset":4688},"indent":[]}},{"type":"text","value":"가 트랜잭션을 보장해준다고 믿을 수 있습니다.","position":{"start":{"line":195,"column":29,"offset":4688},"end":{"line":195,"column":54,"offset":4713},"indent":[]}},{"type":"break","position":{"start":{"line":195,"column":54,"offset":4713},"end":{"line":196,"column":1,"offset":4716},"indent":[1]}},{"type":"text","value":"하지만, ","position":{"start":{"line":196,"column":1,"offset":4716},"end":{"line":196,"column":6,"offset":4721},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">여러 개의 SQL</code>","position":{"start":{"line":196,"column":6,"offset":4721},"end":{"line":196,"column":17,"offset":4732},"indent":[]}},{"type":"text","value":"이 사용되는 작업을 하나의 트랜잭션으로 취급해야 하는 경우가 있습니다.","position":{"start":{"line":196,"column":17,"offset":4732},"end":{"line":196,"column":56,"offset":4771},"indent":[]}},{"type":"break","position":{"start":{"line":196,"column":56,"offset":4771},"end":{"line":197,"column":1,"offset":4774},"indent":[1]}},{"type":"text","value":"(은행 시스템의 계좌 이체 로직)","position":{"start":{"line":197,"column":1,"offset":4774},"end":{"line":197,"column":19,"offset":4792},"indent":[]}}],"position":{"start":{"line":195,"column":1,"offset":4660},"end":{"line":197,"column":19,"offset":4792},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"문제는 첫번째 작업은 성공했지만 다음 작업이 실패하는 경우입니다.","position":{"start":{"line":199,"column":1,"offset":4794},"end":{"line":199,"column":37,"offset":4830},"indent":[]}},{"type":"break","position":{"start":{"line":199,"column":37,"offset":4830},"end":{"line":200,"column":1,"offset":4833},"indent":[1]}},{"type":"text","value":"이런 경우는 앞에서 처리한 ","position":{"start":{"line":200,"column":1,"offset":4833},"end":{"line":200,"column":16,"offset":4848},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">SQL</code>","position":{"start":{"line":200,"column":16,"offset":4848},"end":{"line":200,"column":21,"offset":4853},"indent":[]}},{"type":"text","value":" 작업도 취소 되어야합니다.","position":{"start":{"line":200,"column":21,"offset":4853},"end":{"line":200,"column":36,"offset":4868},"indent":[]}}],"position":{"start":{"line":199,"column":1,"offset":4794},"end":{"line":200,"column":36,"offset":4868},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"이런 취소 작업을 ","position":{"start":{"line":202,"column":1,"offset":4870},"end":{"line":202,"column":11,"offset":4880},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">트랜잭션 롤백</code>","position":{"start":{"line":202,"column":11,"offset":4880},"end":{"line":202,"column":20,"offset":4889},"indent":[]}},{"type":"text","value":"(transaction rollback)이라고 합니다.","position":{"start":{"line":202,"column":20,"offset":4889},"end":{"line":202,"column":50,"offset":4919},"indent":[]}},{"type":"break","position":{"start":{"line":202,"column":50,"offset":4919},"end":{"line":203,"column":1,"offset":4922},"indent":[1]}},{"type":"text","value":"또한, 트랜잭션이 성공적으로 마무리되어 ","position":{"start":{"line":203,"column":1,"offset":4922},"end":{"line":203,"column":23,"offset":4944},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">DB</code>","position":{"start":{"line":203,"column":23,"offset":4944},"end":{"line":203,"column":27,"offset":4948},"indent":[]}},{"type":"text","value":"에 반영하는 작업을 ","position":{"start":{"line":203,"column":27,"offset":4948},"end":{"line":203,"column":38,"offset":4959},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">트랜잭션 커밋</code>","position":{"start":{"line":203,"column":38,"offset":4959},"end":{"line":203,"column":47,"offset":4968},"indent":[]}},{"type":"text","value":"(transaction commit)이라고 합니다.","position":{"start":{"line":203,"column":47,"offset":4968},"end":{"line":203,"column":75,"offset":4996},"indent":[]}}],"position":{"start":{"line":202,"column":1,"offset":4870},"end":{"line":203,"column":75,"offset":4996},"indent":[1]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#userservice와-userdao의-트랜잭션-문제","title":null,"children":[],"data":{"hProperties":{"aria-label":"userservice와 userdao의 트랜잭션 문제 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"UserService와 UserDao의 트랜잭션 문제","position":{"start":{"line":205,"column":6,"offset":5003},"end":{"line":205,"column":35,"offset":5032},"indent":[]}}],"position":{"start":{"line":205,"column":1,"offset":4998},"end":{"line":205,"column":35,"offset":5032},"indent":[]},"data":{"id":"userservice와-userdao의-트랜잭션-문제","htmlAttributes":{"id":"userservice와-userdao의-트랜잭션-문제"},"hProperties":{"id":"userservice와-userdao의-트랜잭션-문제","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"데이터 액세스 코드를 DAO로 만들어서 분리해놓았을 경우에는 DAO 메소드를 호출할 때마다 하나의 ","position":{"start":{"line":207,"column":1,"offset":5034},"end":{"line":207,"column":56,"offset":5089},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">새로운 트랜잭션</code>","position":{"start":{"line":207,"column":56,"offset":5089},"end":{"line":207,"column":66,"offset":5099},"indent":[]}},{"type":"text","value":"이 만들어지는 구조가 될 수밖에 없습니다.","position":{"start":{"line":207,"column":66,"offset":5099},"end":{"line":207,"column":89,"offset":5122},"indent":[]}},{"type":"break","position":{"start":{"line":207,"column":89,"offset":5122},"end":{"line":208,"column":1,"offset":5125},"indent":[1]}},{"type":"text","value":"DAO 메소드에서 DB 커넥션을 매번 만들기 때문에 어쩔 수 없이 나타나는 결과입니다.","position":{"start":{"line":208,"column":1,"offset":5125},"end":{"line":208,"column":49,"offset":5173},"indent":[]}}],"position":{"start":{"line":207,"column":1,"offset":5034},"end":{"line":208,"column":49,"offset":5173},"indent":[1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"여러번 DB에 업데이트를 해야하는 작업을 하나의 트랜잭션으로 묶으려면 ?","position":{"start":{"line":210,"column":3,"offset":5177},"end":{"line":210,"column":43,"offset":5217},"indent":[]}}],"position":{"start":{"line":210,"column":1,"offset":5175},"end":{"line":210,"column":45,"offset":5219},"indent":[]}}],"position":{"start":{"line":210,"column":1,"offset":5175},"end":{"line":210,"column":45,"offset":5219},"indent":[]}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">트랜잭션</code>","position":{"start":{"line":212,"column":1,"offset":5221},"end":{"line":212,"column":7,"offset":5227},"indent":[]}},{"type":"text","value":"은 Connection 오브젝트 안에서 만들어지기 때문에 어떤 일련의 작업이 하나의 트랜잭션으로 묶이려면 그 작업이 진행되는 동안 DB 커넥션이 하나만 사용되면 됩니다.","position":{"start":{"line":212,"column":7,"offset":5227},"end":{"line":212,"column":101,"offset":5321},"indent":[]}}],"position":{"start":{"line":212,"column":1,"offset":5221},"end":{"line":212,"column":101,"offset":5321},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"하지만, 현재는 UserService에서 DB커넥션을 다룰 수 있는 방법이 없습니다.","position":{"start":{"line":214,"column":1,"offset":5323},"end":{"line":214,"column":48,"offset":5370},"indent":[]}}],"position":{"start":{"line":214,"column":1,"offset":5323},"end":{"line":214,"column":48,"offset":5370},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#비즈니스-로직-내의-트랜잭션-경계-설정","title":null,"children":[],"data":{"hProperties":{"aria-label":"비즈니스 로직 내의 트랜잭션 경계 설정 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"비즈니스 로직 내의 트랜잭션 경계 설정","position":{"start":{"line":216,"column":6,"offset":5377},"end":{"line":216,"column":27,"offset":5398},"indent":[]}}],"position":{"start":{"line":216,"column":1,"offset":5372},"end":{"line":216,"column":27,"offset":5398},"indent":[]},"data":{"id":"비즈니스-로직-내의-트랜잭션-경계-설정","htmlAttributes":{"id":"비즈니스-로직-내의-트랜잭션-경계-설정"},"hProperties":{"id":"비즈니스-로직-내의-트랜잭션-경계-설정","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"UserService와 UserDao를 그대로 둔 채로 트랜잭션을 적용하려면 결국 트랜잭션의 경계설정 작업을 UserService 쪽으로 가져와야 합니다.","position":{"start":{"line":218,"column":1,"offset":5400},"end":{"line":218,"column":87,"offset":5486},"indent":[]}}],"position":{"start":{"line":218,"column":1,"offset":5400},"end":{"line":218,"column":87,"offset":5486},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"비즈니스 로직 내의 경계 설정","position":{"start":{"line":220,"column":3,"offset":5490},"end":{"line":220,"column":19,"offset":5506},"indent":[]}}],"position":{"start":{"line":220,"column":1,"offset":5488},"end":{"line":220,"column":21,"offset":5508},"indent":[]}}],"position":{"start":{"line":220,"column":1,"offset":5488},"end":{"line":220,"column":21,"offset":5508},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">Java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// (1) DB Connection 생성</span>\n    <span class=\"token comment\">// (2) 트랜잭션 시작</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token comment\">// (3) DAO 메소드 호출</span>\n        <span class=\"token comment\">// (4) 트랜잭션 커밋</span>\n    <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// (5) 트랜잭션 롤백</span>\n        <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// (6) DB Connection 종료</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":222,"column":1,"offset":5510},"end":{"line":236,"column":4,"offset":5804},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Connection Object 전달","position":{"start":{"line":238,"column":3,"offset":5808},"end":{"line":238,"column":23,"offset":5828},"indent":[]}}],"position":{"start":{"line":238,"column":1,"offset":5806},"end":{"line":238,"column":25,"offset":5830},"indent":[]}}],"position":{"start":{"line":238,"column":1,"offset":5806},"end":{"line":238,"column":25,"offset":5830},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"UserService에서 만든 Connection 오브젝트를 UserDao에서 사용하려면 DAO 메소드를 호출할 때마다 Connection 오브젝트를 파라미터로 전달해줘야 합니다.","position":{"start":{"line":240,"column":1,"offset":5832},"end":{"line":240,"column":101,"offset":5932},"indent":[]}}],"position":{"start":{"line":240,"column":1,"offset":5832},"end":{"line":240,"column":101,"offset":5932},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">Java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> c<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> c<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> c<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":242,"column":1,"offset":5934},"end":{"line":249,"column":4,"offset":6116},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"이렇게 Connection 오브젝트를 전달해서 사용하면 UserService의 ‘upgradeLevels()’ 안에서 시작한 트랜잭션에 UserDao의 메소드들도 참여하게 할 수 있습니다.","position":{"start":{"line":251,"column":1,"offset":6118},"end":{"line":251,"column":106,"offset":6223},"indent":[]}}],"position":{"start":{"line":251,"column":1,"offset":6118},"end":{"line":251,"column":106,"offset":6223},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#userservice-트랜잭션-경계설정의-문제점","title":null,"children":[],"data":{"hProperties":{"aria-label":"userservice 트랜잭션 경계설정의 문제점 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"UserService 트랜잭션 경계설정의 문제점","position":{"start":{"line":253,"column":6,"offset":6230},"end":{"line":253,"column":32,"offset":6256},"indent":[]}}],"position":{"start":{"line":253,"column":1,"offset":6225},"end":{"line":253,"column":32,"offset":6256},"indent":[]},"data":{"id":"userservice-트랜잭션-경계설정의-문제점","htmlAttributes":{"id":"userservice-트랜잭션-경계설정의-문제점"},"hProperties":{"id":"userservice-트랜잭션-경계설정의-문제점","style":"position:relative;"}}},{"type":"list","ordered":true,"start":1,"spread":true,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"DB 커넥션을 비롯한 리소스의 깔끔한 처리를 가능하게 했던 ","position":{"start":{"line":255,"column":4,"offset":6261},"end":{"line":255,"column":37,"offset":6294},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">JdbcTemplate</code>","position":{"start":{"line":255,"column":37,"offset":6294},"end":{"line":255,"column":51,"offset":6308},"indent":[]}},{"type":"text","value":"을 더 이상 활용할 수 없음","position":{"start":{"line":255,"column":51,"offset":6308},"end":{"line":255,"column":66,"offset":6323},"indent":[]}}],"position":{"start":{"line":255,"column":4,"offset":6261},"end":{"line":255,"column":66,"offset":6323},"indent":[]}}],"position":{"start":{"line":255,"column":1,"offset":6258},"end":{"line":256,"column":1,"offset":6324},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"DAO의 메소드와 비즈니스 로직을 담고 있는 UserService의 메소드에 Connection ","position":{"start":{"line":257,"column":4,"offset":6328},"end":{"line":257,"column":58,"offset":6382},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">파라미터가 추가</code>","position":{"start":{"line":257,"column":58,"offset":6382},"end":{"line":257,"column":68,"offset":6392},"indent":[]}},{"type":"text","value":"돼야 함","position":{"start":{"line":257,"column":68,"offset":6392},"end":{"line":257,"column":72,"offset":6396},"indent":[]}}],"position":{"start":{"line":257,"column":4,"offset":6328},"end":{"line":257,"column":72,"offset":6396},"indent":[]}}],"position":{"start":{"line":257,"column":1,"offset":6325},"end":{"line":258,"column":1,"offset":6397},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Connection 파라미터가 UserDao 인터페이스 메소드에 추가되면 UserDao는 더 이상 ","position":{"start":{"line":259,"column":4,"offset":6401},"end":{"line":259,"column":59,"offset":6456},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">데이터 액세스 기술</code>","position":{"start":{"line":259,"column":59,"offset":6456},"end":{"line":259,"column":71,"offset":6468},"indent":[]}},{"type":"text","value":"에 독립적일 수가 없다는 점","position":{"start":{"line":259,"column":71,"offset":6468},"end":{"line":259,"column":86,"offset":6483},"indent":[]}},{"type":"break","position":{"start":{"line":259,"column":86,"offset":6483},"end":{"line":260,"column":4,"offset":6489},"indent":[4]}},{"type":"text","value":"JPA나 하이버네이트로 UserDao의 구현 방식을 변경하려고 하면 Connection 대신 EntityManager나 Session 오브젝트를 UserDao 메소드가 전달받도록 해야 합니다.","position":{"start":{"line":260,"column":4,"offset":6489},"end":{"line":260,"column":111,"offset":6596},"indent":[]}}],"position":{"start":{"line":259,"column":4,"offset":6401},"end":{"line":260,"column":111,"offset":6596},"indent":[4]}}],"position":{"start":{"line":259,"column":1,"offset":6398},"end":{"line":261,"column":1,"offset":6597},"indent":[1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"DAO 메소드에 Connection 파라미터를 받게 하면 ","position":{"start":{"line":262,"column":4,"offset":6601},"end":{"line":262,"column":36,"offset":6633},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">테스트 코드</code>","position":{"start":{"line":262,"column":36,"offset":6633},"end":{"line":262,"column":44,"offset":6641},"indent":[]}},{"type":"text","value":"에도 영향을 줌","position":{"start":{"line":262,"column":44,"offset":6641},"end":{"line":262,"column":52,"offset":6649},"indent":[]}}],"position":{"start":{"line":262,"column":4,"offset":6601},"end":{"line":262,"column":52,"offset":6649},"indent":[]}}],"position":{"start":{"line":262,"column":1,"offset":6598},"end":{"line":262,"column":52,"offset":6649},"indent":[]}}],"position":{"start":{"line":255,"column":1,"offset":6258},"end":{"line":262,"column":52,"offset":6649},"indent":[1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#트랜잭션-동기화","title":null,"children":[],"data":{"hProperties":{"aria-label":"트랜잭션 동기화 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"트랜잭션 동기화","position":{"start":{"line":264,"column":4,"offset":6654},"end":{"line":264,"column":12,"offset":6662},"indent":[]}}],"position":{"start":{"line":264,"column":1,"offset":6651},"end":{"line":264,"column":12,"offset":6662},"indent":[]},"data":{"id":"트랜잭션-동기화","htmlAttributes":{"id":"트랜잭션-동기화"},"hProperties":{"id":"트랜잭션-동기화","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"비즈니스 로직에서 트랜잭션 경계를 설정하려면 어떻게 해야할까?","position":{"start":{"line":266,"column":3,"offset":6666},"end":{"line":266,"column":37,"offset":6700},"indent":[]}}],"position":{"start":{"line":266,"column":1,"offset":6664},"end":{"line":266,"column":39,"offset":6702},"indent":[]}}],"position":{"start":{"line":266,"column":1,"offset":6664},"end":{"line":266,"column":39,"offset":6702},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"스프링은 이 문제를 해결할 수 있는 멋진 방법을 제공해줍니다.","position":{"start":{"line":268,"column":1,"offset":6704},"end":{"line":268,"column":35,"offset":6738},"indent":[]}}],"position":{"start":{"line":268,"column":1,"offset":6704},"end":{"line":268,"column":35,"offset":6738},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#connection-파라미터-제거","title":null,"children":[],"data":{"hProperties":{"aria-label":"connection 파라미터 제거 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Connection 파라미터 제거","position":{"start":{"line":270,"column":6,"offset":6745},"end":{"line":270,"column":24,"offset":6763},"indent":[]}}],"position":{"start":{"line":270,"column":1,"offset":6740},"end":{"line":270,"column":24,"offset":6763},"indent":[]},"data":{"id":"connection-파라미터-제거","htmlAttributes":{"id":"connection-파라미터-제거"},"hProperties":{"id":"connection-파라미터-제거","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"파라미터를 제거하기 위해 스프링이 제안하는 방법은 ","position":{"start":{"line":272,"column":1,"offset":6765},"end":{"line":272,"column":29,"offset":6793},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">트랜잭션 동기화</code>","position":{"start":{"line":272,"column":29,"offset":6793},"end":{"line":272,"column":39,"offset":6803},"indent":[]}},{"type":"text","value":"(transaction synchronization) 방식입니다.","position":{"start":{"line":272,"column":39,"offset":6803},"end":{"line":272,"column":75,"offset":6839},"indent":[]}}],"position":{"start":{"line":272,"column":1,"offset":6765},"end":{"line":272,"column":75,"offset":6839},"indent":[]}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">트랜잭션 동기화</code>","position":{"start":{"line":274,"column":1,"offset":6841},"end":{"line":274,"column":11,"offset":6851},"indent":[]}},{"type":"text","value":"란 UserService에서 트랜잭션을 시작하기 위해 만든 Connection 오브젝트를 특별한 저장소에 보관해두고, 이후에 호출되는 DAO의 메소드에서는 저장된 Connection을 가져다가 사용하게 하는 것입니다.","position":{"start":{"line":274,"column":11,"offset":6851},"end":{"line":274,"column":132,"offset":6972},"indent":[]}}],"position":{"start":{"line":274,"column":1,"offset":6841},"end":{"line":274,"column":132,"offset":6972},"indent":[]}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">트랜잭션 동기화 저장소</code>","position":{"start":{"line":276,"column":1,"offset":6974},"end":{"line":276,"column":15,"offset":6988},"indent":[]}},{"type":"text","value":"는 ","position":{"start":{"line":276,"column":15,"offset":6988},"end":{"line":276,"column":17,"offset":6990},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">작업 스레드마다 독립적</code>","position":{"start":{"line":276,"column":17,"offset":6990},"end":{"line":276,"column":31,"offset":7004},"indent":[]}},{"type":"text","value":"으로 Connection 오브젝트를 저장하고 관리하기 때문에 다중 사용자를 처리하는 서버의 멀티스레드 환경에서도 충돌이 날 염려는 없습니다.","position":{"start":{"line":276,"column":31,"offset":7004},"end":{"line":276,"column":109,"offset":7082},"indent":[]}}],"position":{"start":{"line":276,"column":1,"offset":6974},"end":{"line":276,"column":109,"offset":7082},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#트랜잭션-동기화-적용","title":null,"children":[],"data":{"hProperties":{"aria-label":"트랜잭션 동기화 적용 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"트랜잭션 동기화 적용","position":{"start":{"line":278,"column":6,"offset":7089},"end":{"line":278,"column":17,"offset":7100},"indent":[]}}],"position":{"start":{"line":278,"column":1,"offset":7084},"end":{"line":278,"column":17,"offset":7100},"indent":[]},"data":{"id":"트랜잭션-동기화-적용","htmlAttributes":{"id":"트랜잭션-동기화-적용"},"hProperties":{"id":"트랜잭션-동기화-적용","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"스프링은 JdbcTemplate과 더불어 이런 트랜잭션 동기화 기능을 지원하는 간단한 유틸리티 메소드를 제공하고 있다.","position":{"start":{"line":280,"column":1,"offset":7102},"end":{"line":280,"column":67,"offset":7168},"indent":[]}}],"position":{"start":{"line":280,"column":1,"offset":7102},"end":{"line":280,"column":67,"offset":7168},"indent":[]}},{"type":"html","value":"<div class=\"gatsby-code-title\">Java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">DataSource</span> dataSource<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 트랜잭션 동기화 관리자를 이용해 동기화 작업을 초기화</span>\n        <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">initSynchronization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// DB 커넥션을 생성하고 트랜잭션을 시작</span>\n        <span class=\"token comment\">// 이후의 DAO 작업은 모두 여기서 시작한 트랜잭션 안에서 진행</span>\n        <span class=\"token class-name\">Connection</span> c <span class=\"token operator\">=</span> <span class=\"token class-name\">DataSourceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        c<span class=\"token punctuation\">.</span><span class=\"token function\">setAutoCommit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">upgradeUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            c<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            c<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 예외가 발생하면 롤백</span>\n            <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 스프링 유틸리티 메소드를 이용해 DB 커넥션을 안전하게 닫는다.</span>\n            <span class=\"token class-name\">DataSourceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">releaseConnection</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// 동기화 작업 종료 및 정리</span>\n            <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">unbindResource</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">clearSynchronization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":282,"column":1,"offset":7170},"end":{"line":316,"column":4,"offset":8271},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"스프링이 제공하는 유틸리티 메소드를 쓰는 이유?","position":{"start":{"line":318,"column":3,"offset":8275},"end":{"line":318,"column":29,"offset":8301},"indent":[]}}],"position":{"start":{"line":318,"column":1,"offset":8273},"end":{"line":318,"column":31,"offset":8303},"indent":[]}}],"position":{"start":{"line":318,"column":1,"offset":8273},"end":{"line":318,"column":31,"offset":8303},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"DataSource에서 Connection을 직접 가져오지 않고, 스프링이 제공하는 유틸리티 메소드를 쓰는 이유는 ","position":{"start":{"line":320,"column":1,"offset":8305},"end":{"line":320,"column":65,"offset":8369},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">DataSourceUtils</code>","position":{"start":{"line":320,"column":65,"offset":8369},"end":{"line":320,"column":82,"offset":8386},"indent":[]}},{"type":"text","value":"의 getConnection() 메소드는 ","position":{"start":{"line":320,"column":82,"offset":8386},"end":{"line":320,"column":105,"offset":8409},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">Connection 오브젝트를 생성</code>","position":{"start":{"line":320,"column":105,"offset":8409},"end":{"line":320,"column":126,"offset":8430},"indent":[]}},{"type":"text","value":"해줄 뿐만 아니라 트랜잭션 동기화에 사용하도록 ","position":{"start":{"line":320,"column":126,"offset":8430},"end":{"line":320,"column":152,"offset":8456},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">저장소에 바인딩</code>","position":{"start":{"line":320,"column":152,"offset":8456},"end":{"line":320,"column":162,"offset":8466},"indent":[]}},{"type":"text","value":"해주기 때문에 사용합니다.","position":{"start":{"line":320,"column":162,"offset":8466},"end":{"line":320,"column":176,"offset":8480},"indent":[]}}],"position":{"start":{"line":320,"column":1,"offset":8305},"end":{"line":320,"column":176,"offset":8480},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"만약 여러 개의 DB에 접근하고 싶다면?","position":{"start":{"line":322,"column":3,"offset":8484},"end":{"line":322,"column":25,"offset":8506},"indent":[]}}],"position":{"start":{"line":322,"column":1,"offset":8482},"end":{"line":322,"column":27,"offset":8508},"indent":[]}}],"position":{"start":{"line":322,"column":1,"offset":8482},"end":{"line":322,"column":27,"offset":8508},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"한 개 이상의 DB로의 작업을 하나의 트랜잭션으로 만드는 것은 JDBC의 Connection을 이용한 트랜잭션 방식인 로컬 트랜잭션으로는 불가능합니다.","position":{"start":{"line":324,"column":1,"offset":8510},"end":{"line":324,"column":85,"offset":8594},"indent":[]}},{"type":"break","position":{"start":{"line":324,"column":85,"offset":8594},"end":{"line":325,"column":1,"offset":8597},"indent":[1]}},{"type":"text","value":"따라서, 별도의 트랜잭션 관리자를 통해 ","position":{"start":{"line":325,"column":1,"offset":8597},"end":{"line":325,"column":23,"offset":8619},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">글로벌 트랜잭션</code>","position":{"start":{"line":325,"column":23,"offset":8619},"end":{"line":325,"column":33,"offset":8629},"indent":[]}},{"type":"text","value":" 방식을 사용해야합니다.","position":{"start":{"line":325,"column":33,"offset":8629},"end":{"line":325,"column":46,"offset":8642},"indent":[]}}],"position":{"start":{"line":324,"column":1,"offset":8510},"end":{"line":325,"column":46,"offset":8642},"indent":[1]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"자바에서는 글로벌 트랜잭션 매니저인 ","position":{"start":{"line":327,"column":3,"offset":8646},"end":{"line":327,"column":23,"offset":8666},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">JTA</code>","position":{"start":{"line":327,"column":23,"offset":8666},"end":{"line":327,"column":28,"offset":8671},"indent":[]}},{"type":"text","value":"를 제공 !!","position":{"start":{"line":327,"column":28,"offset":8671},"end":{"line":327,"column":35,"offset":8678},"indent":[]}}],"position":{"start":{"line":327,"column":3,"offset":8646},"end":{"line":327,"column":35,"offset":8678},"indent":[]}}],"position":{"start":{"line":327,"column":1,"offset":8644},"end":{"line":327,"column":35,"offset":8678},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#기술과-환경에-종속되는-트랜잭션","title":null,"children":[],"data":{"hProperties":{"aria-label":"기술과 환경에 종속되는 트랜잭션 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"기술과 환경에 종속되는 트랜잭션","position":{"start":{"line":329,"column":4,"offset":8683},"end":{"line":329,"column":21,"offset":8700},"indent":[]}}],"position":{"start":{"line":329,"column":1,"offset":8680},"end":{"line":329,"column":21,"offset":8700},"indent":[]},"data":{"id":"기술과-환경에-종속되는-트랜잭션","htmlAttributes":{"id":"기술과-환경에-종속되는-트랜잭션"},"hProperties":{"id":"기술과-환경에-종속되는-트랜잭션","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"또 다른 새로운 문제는 ","position":{"start":{"line":331,"column":1,"offset":8702},"end":{"line":331,"column":14,"offset":8715},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">하이버네이트</code>","position":{"start":{"line":331,"column":14,"offset":8715},"end":{"line":331,"column":22,"offset":8723},"indent":[]}},{"type":"text","value":"를 이용한 트랜잭션 관리 코드는 ","position":{"start":{"line":331,"column":22,"offset":8723},"end":{"line":331,"column":40,"offset":8741},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">JDBC</code>","position":{"start":{"line":331,"column":40,"offset":8741},"end":{"line":331,"column":46,"offset":8747},"indent":[]}},{"type":"text","value":"나 ","position":{"start":{"line":331,"column":46,"offset":8747},"end":{"line":331,"column":48,"offset":8749},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">JTA</code>","position":{"start":{"line":331,"column":48,"offset":8749},"end":{"line":331,"column":53,"offset":8754},"indent":[]}},{"type":"text","value":"의 코드와는 또 다르다는 것입니다.","position":{"start":{"line":331,"column":53,"offset":8754},"end":{"line":331,"column":72,"offset":8773},"indent":[]}},{"type":"break","position":{"start":{"line":331,"column":72,"offset":8773},"end":{"line":332,"column":1,"offset":8776},"indent":[1]}},{"type":"html","value":"<code class=\"language-text\">하이버네이트</code>","position":{"start":{"line":332,"column":1,"offset":8776},"end":{"line":332,"column":9,"offset":8784},"indent":[]}},{"type":"text","value":"는 Connection을 직접 사용하지 않고 ","position":{"start":{"line":332,"column":9,"offset":8784},"end":{"line":332,"column":34,"offset":8809},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">Session</code>","position":{"start":{"line":332,"column":34,"offset":8809},"end":{"line":332,"column":43,"offset":8818},"indent":[]}},{"type":"text","value":"이라는 것을 사용하고, 독자적인 트랜잭션 관리 API를 사용합니다.","position":{"start":{"line":332,"column":43,"offset":8818},"end":{"line":332,"column":80,"offset":8855},"indent":[]}}],"position":{"start":{"line":331,"column":1,"offset":8702},"end":{"line":332,"column":80,"offset":8855},"indent":[1]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#스프링의-트랜잭션-서비스-추상화","title":null,"children":[],"data":{"hProperties":{"aria-label":"스프링의 트랜잭션 서비스 추상화 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"스프링의 트랜잭션 서비스 추상화","position":{"start":{"line":334,"column":6,"offset":8862},"end":{"line":334,"column":23,"offset":8879},"indent":[]}}],"position":{"start":{"line":334,"column":1,"offset":8857},"end":{"line":334,"column":23,"offset":8879},"indent":[]},"data":{"id":"스프링의-트랜잭션-서비스-추상화","htmlAttributes":{"id":"스프링의-트랜잭션-서비스-추상화"},"hProperties":{"id":"스프링의-트랜잭션-서비스-추상화","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"스프링은 트랜잭션 기술의 공통점을 담은 트랜잭션 추상화 기술을 제공합니다.","position":{"start":{"line":336,"column":1,"offset":8881},"end":{"line":336,"column":42,"offset":8922},"indent":[]}}],"position":{"start":{"line":336,"column":1,"offset":8881},"end":{"line":336,"column":42,"offset":8922},"indent":[]}},{"type":"paragraph","children":[{"type":"html","title":null,"url":"./images/transaction-abstraction.png","alt":"스프링의 트랜잭션 추상화 계층","position":{"start":{"line":338,"column":1,"offset":8924},"end":{"line":338,"column":58,"offset":8981},"indent":[]},"value":"<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b0e6eead0d8de6fb10314f6a56a58e4/b2cef/transaction-abstraction.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACiUlEQVQ4y21Sa0/UQBTdX+kXo6IxmBj/gdEYJRLDB2OIGmFBRL4oSpRFPxg1BE1Ansp2y0N2t91nt92WXWg7nenjeDu7Aone5OTce87cmzvTZtCP5AzivrbadPBw/QDTSgUvFB2jm0XkDpp/W2C221B3dqBXKtB0HZVqFRlwDgQBJBMSyhMeyskVx8NiycRKxcaybmNJs1AwukBEZhSDdbtwDAOu4+CIhh/bNg3sdADPQ+K6EvB8JLaBuKoC9V2gsUe8gyStG7069eKWDvg+IAQQhj2mZXobnrluGlFxCfzzMPj3x4Sn4GvTEOsz4CsT4Euj4F9HZJ2GRVtVajXUm01wGpxJGOsNixNCLPNIX4NYnkT48y3E5ivCa8Iswq1ZiK03EKsvEeZzcmCXbmiaJuy2TUuKdMMA/0b6RqSHTHJCHHO6XsT6OiGJ8L/IiCMXXEQ0V9CTCLA+Ak6PHkRgLIRP8PzwpOYilpye832OgAnZzwO6srr8G8q6DmW1DGVNQ4Hy/EmuST5bb/8oQd3on+n7qS69lRIylmbAbB7CrDswqjbMhiPzNmlWo6e3Uq9mwyLNpt/m0Domv0M+eaRLj8626ulv49G70Oqg1eEGp7nP+ky1x3twGZjRBmuZEJZDWnDqyT76KIdBE6ZfhuXraLopa7CYjiNuwWY1yjWYnoYWod7Zw3L+C/L7G9jY/YZ6d1/2Ga4mz6V5JqsMYEK5grH8RWTzA3heGMSTX+cwrV7HlHoNz7bPI6tclphSB5FVL2CudBMzezcwWej1jRMmC1cxrlxCZqE8jPnSEN4X70peKA1j7uAWPumP8LE8gnfFO1LPSe8+ebexWB3Dh9IDzBeHCPckcuSl/Ac3VLGQyKLfiQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"스프링의 트랜잭션 추상화 계층\"\n        title=\"스프링의 트랜잭션 추상화 계층\"\n        src=\"/static/2b0e6eead0d8de6fb10314f6a56a58e4/1d69c/transaction-abstraction.png\"\n        srcset=\"/static/2b0e6eead0d8de6fb10314f6a56a58e4/4dcb9/transaction-abstraction.png 188w,\n/static/2b0e6eead0d8de6fb10314f6a56a58e4/5ff7e/transaction-abstraction.png 375w,\n/static/2b0e6eead0d8de6fb10314f6a56a58e4/1d69c/transaction-abstraction.png 750w,\n/static/2b0e6eead0d8de6fb10314f6a56a58e4/b2cef/transaction-abstraction.png 847w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>"}],"position":{"start":{"line":338,"column":1,"offset":8924},"end":{"line":338,"column":58,"offset":8981},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"출처 : ","position":{"start":{"line":340,"column":1,"offset":8983},"end":{"line":340,"column":6,"offset":8988},"indent":[]}},{"type":"link","title":null,"url":"https://yangbongsoo.gitbooks.io","children":[{"type":"text","value":"https://yangbongsoo.gitbooks.io","position":{"start":{"line":340,"column":6,"offset":8988},"end":{"line":340,"column":37,"offset":9019},"indent":[]}}],"position":{"start":{"line":340,"column":6,"offset":8988},"end":{"line":340,"column":37,"offset":9019},"indent":[]}}],"position":{"start":{"line":340,"column":1,"offset":8983},"end":{"line":340,"column":37,"offset":9019},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#트랜잭션-서비스-추상화-적용","title":null,"children":[],"data":{"hProperties":{"aria-label":"트랜잭션 서비스 추상화 적용 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"트랜잭션 서비스 추상화 적용","position":{"start":{"line":342,"column":6,"offset":9026},"end":{"line":342,"column":21,"offset":9041},"indent":[]}}],"position":{"start":{"line":342,"column":1,"offset":9021},"end":{"line":342,"column":21,"offset":9041},"indent":[]},"data":{"id":"트랜잭션-서비스-추상화-적용","htmlAttributes":{"id":"트랜잭션-서비스-추상화-적용"},"hProperties":{"id":"트랜잭션-서비스-추상화-적용","style":"position:relative;"}}},{"type":"html","value":"<div class=\"gatsby-code-title\">Java</div>"},{"type":"html","lang":"java","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PlatformTransactionManager</span> transactionManager<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">TransactionStatus</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultTransactionDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">RuntimeException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":344,"column":1,"offset":9043},"end":{"line":369,"column":4,"offset":9756},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#정리","title":null,"children":[],"data":{"hProperties":{"aria-label":"정리 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"정리","position":{"start":{"line":371,"column":4,"offset":9761},"end":{"line":371,"column":6,"offset":9763},"indent":[]}}],"position":{"start":{"line":371,"column":1,"offset":9758},"end":{"line":371,"column":6,"offset":9763},"indent":[]},"data":{"id":"정리","htmlAttributes":{"id":"정리"},"hProperties":{"id":"정리","style":"position:relative;"}}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"비즈니스 로직을 담은 코드는 데이터 액세스 로직 코드와 분리되어야 함","position":{"start":{"line":373,"column":3,"offset":9767},"end":{"line":373,"column":41,"offset":9805},"indent":[]}}],"position":{"start":{"line":373,"column":3,"offset":9767},"end":{"line":373,"column":41,"offset":9805},"indent":[]}}],"position":{"start":{"line":373,"column":1,"offset":9765},"end":{"line":373,"column":41,"offset":9805},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"DAO를 사용하는 비즈니스 로직에는 단위 작업을 보장해주는 트랜잭션이 필요","position":{"start":{"line":374,"column":3,"offset":9808},"end":{"line":374,"column":44,"offset":9849},"indent":[]}}],"position":{"start":{"line":374,"column":3,"offset":9808},"end":{"line":374,"column":44,"offset":9849},"indent":[]}}],"position":{"start":{"line":374,"column":1,"offset":9806},"end":{"line":374,"column":44,"offset":9849},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"스프링이 제공하는 트랜잭션 동기화 기법, 트랜잭션 추상화 기법을 활용","position":{"start":{"line":375,"column":3,"offset":9852},"end":{"line":375,"column":41,"offset":9890},"indent":[]}}],"position":{"start":{"line":375,"column":3,"offset":9852},"end":{"line":375,"column":41,"offset":9890},"indent":[]}}],"position":{"start":{"line":375,"column":1,"offset":9850},"end":{"line":375,"column":41,"offset":9890},"indent":[]}}],"position":{"start":{"line":373,"column":1,"offset":9765},"end":{"line":375,"column":41,"offset":9890},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#마무리","title":null,"children":[],"data":{"hProperties":{"aria-label":"마무리 permalink","class":"anchor-header before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"마무리","position":{"start":{"line":377,"column":4,"offset":9895},"end":{"line":377,"column":7,"offset":9898},"indent":[]}}],"position":{"start":{"line":377,"column":1,"offset":9892},"end":{"line":377,"column":7,"offset":9898},"indent":[]},"data":{"id":"마무리","htmlAttributes":{"id":"마무리"},"hProperties":{"id":"마무리","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"다음은 포스트에서는 ","position":{"start":{"line":379,"column":1,"offset":9900},"end":{"line":379,"column":12,"offset":9911},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">단일 책임 원칙</code>","position":{"start":{"line":379,"column":12,"offset":9911},"end":{"line":379,"column":22,"offset":9921},"indent":[]}},{"type":"text","value":"과 ","position":{"start":{"line":379,"column":22,"offset":9921},"end":{"line":379,"column":24,"offset":9923},"indent":[]}},{"type":"html","value":"<code class=\"language-text\">테스트를 위한 서비스 추상화</code>","position":{"start":{"line":379,"column":24,"offset":9923},"end":{"line":379,"column":41,"offset":9940},"indent":[]}},{"type":"text","value":"에 대해 알아보겠습니다.","position":{"start":{"line":379,"column":41,"offset":9940},"end":{"line":379,"column":54,"offset":9953},"indent":[]}}],"position":{"start":{"line":379,"column":1,"offset":9900},"end":{"line":379,"column":54,"offset":9953},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":380,"column":1,"offset":9954}}}}