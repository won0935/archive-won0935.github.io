{"data":{"site":{"siteMetadata":{"title":"Jay 기술 블로그","author":"won0935","siteUrl":"https://won0935.github.io"}},"markdownRemark":{"id":"228af57d-fb80-5296-b325-20ba18347631","excerpt":"1. 영속성 컨텍스트란? JPA를 이해하는데 가장 중요한 용어는 입니다. 해석하자면, ‘엔티티를 영구 저장하는 환경’이라는 뜻입니다. 논리적인 개념에 가까우며 엔티티 매니저를 생성할 때 하나 만들어집니다. 엔티티 매니저를 통해 영속성 컨텍스트에 접근하고 관리할 수 있습니다.…","html":"<h2 id=\"1-영속성-컨텍스트란\" style=\"position:relative;\"><a href=\"#1-%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EB%9E%80\" aria-label=\"1 영속성 컨텍스트란 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 영속성 컨텍스트란?</h2>\n<p>JPA를 이해하는데 가장 중요한 용어는 <code class=\"language-text\">영속성 컨텍스트(persistence context)</code>입니다.</p>\n<p>해석하자면, ‘엔티티를 영구 저장하는 환경’이라는 뜻입니다.</p>\n<p>논리적인 개념에 가까우며 엔티티 매니저를 생성할 때 하나 만들어집니다.</p>\n<p>엔티티 매니저를 통해 영속성 컨텍스트에 접근하고 관리할 수 있습니다.</p>\n<h2 id=\"2-엔티티의-생명주기\" style=\"position:relative;\"><a href=\"#2-%EC%97%94%ED%8B%B0%ED%8B%B0%EC%9D%98-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0\" aria-label=\"2 엔티티의 생명주기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 엔티티의 생명주기</h2>\n<p>엔티티에는 4가지 상태가 존재합니다.</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">상태</th>\n<th align=\"left\">내용</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\">비영속(new/transient)</td>\n<td align=\"left\">영속성 컨텍스트와 전혀 관계가 없는 상태</td>\n</tr>\n<tr>\n<td align=\"left\">영속(merged)</td>\n<td align=\"left\">영속성 컨텍스트에 저장된 상태</td>\n</tr>\n<tr>\n<td align=\"left\">준영속(detached)</td>\n<td align=\"left\">영속성 컨텍스트에서 저장되었다가 분리된 상태</td>\n</tr>\n<tr>\n<td align=\"left\">삭제(removed)</td>\n<td align=\"left\">삭제된 상태</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"비영속\" style=\"position:relative;\"><a href=\"#%EB%B9%84%EC%98%81%EC%86%8D\" aria-label=\"비영속 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>비영속</h4>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// 객체를 생성한 상태(비영속)</span>\n<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token number\">100L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"회원1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"영속\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D\" aria-label=\"영속 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영속</h4>\n<p>영속상태 = 영속성 컨텍스트에 의해 관리된다는 뜻입니다.</p>\n<p><code class=\"language-text\">em.find()</code>나 <code class=\"language-text\">JPQL</code>를 사용해서 조회한 엔티티도 영속 상태 !</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\">em<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 객체를 영속성 컨텍스트에 저장</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h4 id=\"준영속\" style=\"position:relative;\"><a href=\"#%EC%A4%80%EC%98%81%EC%86%8D\" aria-label=\"준영속 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>준영속</h4>\n<p>영속성 컨텍스트가 관리하던 영속 상태의 엔티티를 영속성 컨텍스트가 관리하지 않으면 ‘준영속 상태’입니다.</p>\n<ul>\n<li><code class=\"language-text\">em.detach()</code> 호출로 준영속 상태 명시적 호출</li>\n<li><code class=\"language-text\">em.close()</code>를 호출해서 영속성 컨텍스트를 닫음</li>\n<li><code class=\"language-text\">em.clear()</code>로 영속성 컨텍스트 초기화</li>\n</ul>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\">em<span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h4 id=\"삭제\" style=\"position:relative;\"><a href=\"#%EC%82%AD%EC%A0%9C\" aria-label=\"삭제 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>삭제</h4>\n<p>엔티티를 영속성 컨텍스트와 데이터베이스에서 삭제 !</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\">em<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"3-영속성-컨텍스트의-특징\" style=\"position:relative;\"><a href=\"#3-%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%9D%98-%ED%8A%B9%EC%A7%95\" aria-label=\"3 영속성 컨텍스트의 특징 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 영속성 컨텍스트의 특징</h2>\n<ol>\n<li>\n<p>영속성 컨텍스트와 식별자 값</p>\n<ul>\n<li>엔티티를 식별자 값(@id로 테이블의 기본 키와 매핑한 값)으로 구분</li>\n<li>영속 상태는 식별자 값이 반드시 있어야 함 -> 식별자 값이 없으면 예외 발생</li>\n</ul>\n</li>\n<li>\n<p>영속성 컨텍스트와 데이터베이스 저장</p>\n<ul>\n<li>JPA는 보통 트랜잭션을 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영하는데 이것을 <code class=\"language-text\">플러시(flush)</code>라 합니다.</li>\n</ul>\n</li>\n<li>\n<p>영속성 컨텍스트가 엔티티를 관리하는 것의 장점 5가지</p>\n<ul>\n<li>1차 캐시</li>\n<li>동일성 보장</li>\n<li>트랜잭션을 지원하는 쓰기 지연</li>\n<li>변경 감지</li>\n<li>지연 로딩</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"1-엔티티-조회\" style=\"position:relative;\"><a href=\"#1-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%A1%B0%ED%9A%8C\" aria-label=\"1 엔티티 조회 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 엔티티 조회</h4>\n<ul>\n<li>\n<p>영속성 컨텍스트는 내부에 캐시를 가지고 있음</p>\n<ul>\n<li><code class=\"language-text\">1차 캐시</code></li>\n</ul>\n</li>\n<li>영속 상태의 엔티티는 모두 이곳에 저장 !</li>\n</ul>\n<p><strong>엔티티 조회</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><code class=\"language-text\">em.find()</code> 호출되면 <code class=\"language-text\">1차 캐시</code>에서 엔티티 조회 ! -> 엔티티가 1차 캐시에 없으면 <code class=\"language-text\">데이터베이스</code> 조회</p>\n<p><strong>1차 캐시에서 엔티티 조회</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token number\">100L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmember<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"회원1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 1차 캐시에 저장됨</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 1차 캐시에서 조회</span>\n<span class=\"token class-name\">Member</span> findMember <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f7fe184bba1ab6f5649ea355d383e53/bce1e/JPA_3_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.42553191489361%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC4UlEQVQ4yyVTWW/TQBj0D0I8IJC4Cm1pGseOHd9X4vh27ISkudqk6okKKuWQkPjBw9g8rHa93p2dmW8+4ehEQ6dr4VS0IfZdqEYI3Yrh+DksL4Wqj9o92y/gjSq4o8n/eTiBH9bt7A5LxPkC43QOoSNaECUXkuKjrw15eYy0XKGotwjjOTYX91if3+Lm7gm39z9w//CrnR++/sbN7XfsLx9wvvuCyewC+6tvEESZYGoARRuRWQLdTpEWS7KoYToTzBZXmEwvMJ9fYrO8wnZzj+36Dpv1NWbTLRbzHap60ypYrK4hNFIl1SfDAP1BiIGZEHANNyhhuSVlTVtwbzSFHUxguhmcZnZyyq+5Lrlf0KIC0/megD0bvb5PhuN2qEZCP9Y8WLVsAwK6XDt+xQfoKwG9YYUoXWKcreDRR5t+Nw9NyZaSPWhGzIMFNDuDwnVcrODwksq17mQw+M8gI0WPcb7/im+Pf/D08y+q2Y6PZi1LjYXMJysIJ12XUiNeICA9VM0UcbmB6ZWQtQiSFkPlvmHHGEZT2nGGNJ+jqJZcL8i2IBn+dxIk+RmED8cDdEQf8iBugft6giBaYGDnENWQI+I6QUcyGIuaXls4PlVwyu84m8IfpfjUVduIxRljI0o2LCeF5zNXNNughMabhnEj2R7OMExWLM4Mo/gzPa15JsGcFb+6fsRqc4NRVBOQ95LPEGTZgUezxwxr4OXQTXqYL+H6rB69C9M1sskO47iRuW1HnJ0xm19wd/2E/e6BgDM2QMgklBBeve7g/aGKwxMDJ4zQ4ScdNoEVLeShiB7VyBgjP6xaZk0SmmrrVsqCpVSSMmpjWuHB5H/h4KOMqlxivdghYetIfa8twDiZIaKEOFsQZEifmgdNdCWn7aqGkUYgha152rPw5p0IiU0iPHv+FgcfJHS7JmcZL14e4fBIgUoQRQvaXpZVj1l10aM9MpugPwgYNSoY8Ay7rEegLvPs0Md/uYoc+xyG4akAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1차 캐시에서 조회\"\n        title=\"1차 캐시에서 조회\"\n        src=\"/static/0f7fe184bba1ab6f5649ea355d383e53/1d69c/JPA_3_1.png\"\n        srcset=\"/static/0f7fe184bba1ab6f5649ea355d383e53/4dcb9/JPA_3_1.png 188w,\n/static/0f7fe184bba1ab6f5649ea355d383e53/5ff7e/JPA_3_1.png 375w,\n/static/0f7fe184bba1ab6f5649ea355d383e53/1d69c/JPA_3_1.png 750w,\n/static/0f7fe184bba1ab6f5649ea355d383e53/78797/JPA_3_1.png 1125w,\n/static/0f7fe184bba1ab6f5649ea355d383e53/aa440/JPA_3_1.png 1500w,\n/static/0f7fe184bba1ab6f5649ea355d383e53/bce1e/JPA_3_1.png 1696w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>데이터베이스에서 엔티티 조회</strong></p>\n<ul>\n<li>엔티티가 1차 캐시에 없으면 엔티티 매니저는 데이터베이스를 조회해서 엔티티를 생성함</li>\n<li>1차 캐시에 저장한 후에 영속 상태의 엔티티를 반환함</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c652a5e3badaeab85111510cf0342d92/c6720/JPA_3_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.36170212765958%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/ElEQVQ4yy1TaXPiRhTUX0m2ctRu4mOx12VzGAMyp04khA4kBAgQl4mNjddrk9pQ603lw1b+caelzYdXo6l509OvuyWUKhrEqoFqo4Nay4LRHaI/XCEYLNEL53D8GAH3o+k9ovie6y3rDsPxLXtHcIMZ+5boOBGUdgBBrJmot7qQVA+y1oPdm2I82+Dx0yte/vwHL5++4OnjHrvd3/j6+i/2+2/Yvbzi4fFzCpg8GI7W6aoZIYTKdRsN2UFTdiEpPbj+HF4wh24O4fQW6AVJLf9fFwjCFTx/hnG8geWO0fUmJBGT4Zh3BhDKop4ybMkeGpLHwxm8/gqyHqDrTtN9x56ibY2gmSHMbpSex8unFMS0oxQ0YdvujMiQ+sman25kvQ/Li+GRhdwOqUnIURb4+PyK/ZdviBeP0Nln9+bU8I4gUap52xpANQJikGFJ5MhSj3QjSBpZEcANbwjYh8Kmbm+CMFphtnwgyJqXE5YDjGmSTgCl7adVl7qpdMJlWYFY58hqSGMCmG4Mw4lRk2yWyZFCXFYklKoqLCekqxFBA0xmW7QUj+cjGGTYVBxUam0IdcZlyFis5ls4ziQ1JYxuyWIMf7DGdPkMP1zDsCcYjf/Aw2bHBHzFcr1L9YwX35lbzgiK5kHIFZr88OF4UzRadupUh0KrHNn1l8zcFqZFOVQfU+bwcfsZ99s97h7+4oMrGtVnbFbY3L/A6DA2x5kiMh/KOMvWkS/KDLiF67pJXW2Ewxus1k8YRDc0YkLAO2xunzEjqySrSfD7gwU0athJxqaOwnm2iib/EJkaiNU2as0OdJqhm0EKXChJyF42kC00cJGvI9E8+btaipv2Nxm50zMRZ+ciTj6UIGROi9BUG5rmIM+LF7k6M2mjSrDzXA25wnewLMHylCeRqFCUcF0z8P7kCseZK2ROr3CUyeH3owsIP7w5wI8/HeLntxn88vYEB0d5XqojS+DilYxSWSUjFWVRQ+Vah0gnk0oeOjwuEPASB8cX+O3wDL++O8F/spcOzAQLWmMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"데이터베이스에서 조회\"\n        title=\"데이터베이스에서 조회\"\n        src=\"/static/c652a5e3badaeab85111510cf0342d92/1d69c/JPA_3_2.png\"\n        srcset=\"/static/c652a5e3badaeab85111510cf0342d92/4dcb9/JPA_3_2.png 188w,\n/static/c652a5e3badaeab85111510cf0342d92/5ff7e/JPA_3_2.png 375w,\n/static/c652a5e3badaeab85111510cf0342d92/1d69c/JPA_3_2.png 750w,\n/static/c652a5e3badaeab85111510cf0342d92/78797/JPA_3_2.png 1125w,\n/static/c652a5e3badaeab85111510cf0342d92/aa440/JPA_3_2.png 1500w,\n/static/c652a5e3badaeab85111510cf0342d92/c6720/JPA_3_2.png 1922w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"2-엔티티-등록\" style=\"position:relative;\"><a href=\"#2-%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%93%B1%EB%A1%9D\" aria-label=\"2 엔티티 등록 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 엔티티 등록</h4>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">EntityManager</span> em <span class=\"token operator\">=</span> emf<span class=\"token punctuation\">.</span><span class=\"token function\">createEntityManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">EntityTransaction</span> transaction <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ntransaction<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 트랜잭션 시작</span>\n\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>memberA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>memberB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 여기까지 INSERT SQL을 데이터베이스에 보내지 않는다.</span>\n\ntransaction<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 트랜잭션 커밋</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>엔티티 매니저는 트랜잭션을 커밋하기 직전까지 데이터베이스의 엔티티를 저장하지 않음</li>\n<li>내부 쿼리 저장소에 INSERT SQL을 차곡차곡 모음</li>\n<li>트랜잭션 커밋할 때 모아둔 SQL 쿼리를 데이터베이스에 보냄</li>\n<li>트랜잭션을 지원하는 <code class=\"language-text\">쓰기 지연</code></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df8faa1a39b4d2477bc0a495b71ad191/1d7f7/JPA_3_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.5531914893617%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADMklEQVQ4yy1T23bqVBTNv+g4jnpaawv0AAVaKFBCuCYhBBLIpUmBcLUUbMHT6tF6hmP47mUM/8APUV/8pOlM6sNKdnbWnmuuOdcWrkoypHof9aaJhjxAW7WhaC7aHQct1Yr2VN1DfxhEYdpTWO4cQ4ZhhXuTKJTuDXOHEGQCqF0X4bvb97Hefov900e8fP8z9vsXbDZPeHj4Du/ff8Tz80+YLnYEW2BgzzAK7mHfLGF7S3SNW7QUG0ItZNcyUanpaLSHMIZTDB0ysGa4HW+xvHvC/fYDHnYvjB9Z8AOBtnD8FSaz7f/MJ+j0fAI6EKR6D7WmgSqBq3UDUnOApupCbJg8dMf2lnDIYnW3x5iMlqsdFqs9LG+FBfd0YxSxU9myovkQ6i0DLdli2Kw0hTtaw7m9o1ZzjKdfM3kCefgVNGcN3V3D8LcwR4/MnSGYP0CjTK+ah9J5EMRaD2LNQK1lQ9Y8aARwxxuYzgJdM4gMaW1/h/zrvzB/+xvjP/6C/ss/6L/8ifnykWfcyDgx7JTkBMuZwRgE6Jkz+ATyJlt0jADXjQGkts0CQcTWnuxg+fdRsWD1jAFZmnRZ1hw0lSHl6qFQliHoEWWHP6e4nWwIeg+1N0JJ1FGXHYLP+fbY3iN2+x/wDd12Cdw3pzQwoBFWNB1a74agOoSrUhu5fB2FkoqKpKOr+7A5Fnp/xGQKTV3C5J7pMXyCzWnUjNp5cLxFpN9ossZ0toEodSHkC01kchIyFzXkOeQ1Uq8zQk3kjgupoXGcdH6ryOZFjpdC4JtoTzc8FK9lNDh2SsdCSE5InV8jfnaF03geZ8ny6zqRRyJZxEWhQVDelrbBm9RHvtiCQ3bLOZ0ejNCkGanzChLviniXKiLGc0IscYnDL9J4e5TC8UmGkYviJHYZgYdVmzKvJR1MZ0X0DR8LDnSTrERJI1AZJ3GeOT3H4XGKgPEsjrj4/OiMQGlGNqoUPysgmS6jdK2gWutGUaSL7fBuKwNUqVdF6rCbCwIlcXCYwJuDUwgHfMRiGTLK8GeWreYj+iFYJicid0F9c9XX9WWodTX6TmcqOM+W2V2SQDF8+tmX+OTNMf4D5KU0yMpj5Y4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"엔티티 등록\"\n        title=\"엔티티 등록\"\n        src=\"/static/df8faa1a39b4d2477bc0a495b71ad191/1d69c/JPA_3_3.png\"\n        srcset=\"/static/df8faa1a39b4d2477bc0a495b71ad191/4dcb9/JPA_3_3.png 188w,\n/static/df8faa1a39b4d2477bc0a495b71ad191/5ff7e/JPA_3_3.png 375w,\n/static/df8faa1a39b4d2477bc0a495b71ad191/1d69c/JPA_3_3.png 750w,\n/static/df8faa1a39b4d2477bc0a495b71ad191/78797/JPA_3_3.png 1125w,\n/static/df8faa1a39b4d2477bc0a495b71ad191/aa440/JPA_3_3.png 1500w,\n/static/df8faa1a39b4d2477bc0a495b71ad191/1d7f7/JPA_3_3.png 2038w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>트랜잭션 커밋시 플러시, 동기화 동작</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c68e6ae05da7023236cda1cba9090d4/26162/JPA_3_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADP0lEQVQ4yx2T2XIaVxCG51VcUixL0YIQQgJLiF2IYdhngGGYFRgWsToKtmQZW7KdVDmpVFK5ylUeIo+Qy7zTn59z0TVNnz5/f919kOKpElKZKmSlhVK1g5rmQmv1oNJqDRfluoV6s4u2dQvDvkXHuYXtTdE2R4x70M0h42ORU6pZkDZiObmBdmeAht7D8m6N9+uf8fz8Kz5++gWrd094/PAT/W/4/OU3nn9Ef3SH7mApBNvWCE5vgRbvl+s2pNiVgryio9HuQy62oXdG8Id38PtLTCYPmE4fsFg8Yjq7p38Px1uQagS3v4BGgKbhU2wo/ErdhXQZVwRhQ/cpaDB5zMMhTG+G+Q9rLGiz5Rp2dy7GYDNuUdQfvxW/Nb1P0YFouab1IF1xhhsy05mgqnloUbDW7KPIaqWaw1gXFdUTvtryYbkzMU+7u0BVdShik8zkucmZexvCIjK5JskmUCo2DGcKw51T1EeJQgqFKxTVrQnJ5qJdrdWH21tC452GPYXKr1wxCdaCVK4Y6DDJcjmT1oAUA2gGt6YPKM72ukvaGxbh4I0hKbpse8GlrGB8+wfdv/7F4O//oE6+IJmUIWUyFeRlTSyjwraUsgmlauNGMbC6/4qnr3/gzeqZ9A6KjJdqNsV+xO18jeHD7/Af/0R19IS6NcONrEI6i2QRjckoMzmVrQvsnFxHo+XwXbbFfNSmw6W5yBVUzoxvrzPGgEvpeWMYjPu9MUyzjyThpOOTODaieaWJeKqM7I3KA4UkOr8lpK/LHH4HhtVjjopCqU1SE15/DtMaQjc2r0NHgZZIliDtfn+Oo2AMCW77NJzGBWmzuTqJDVEkm1fR6fhwnTEUim3+WZnrGvKFJsKRDKIXN+LO68scQuEkpO2dIHb3zxi4xv5hBKHTJGJxGTkKpTJl+go8b4LZdCVEohc5CuQRTxQRDCVwwvzAySUOj6PYPzqHtLV9iK3vAoi8TrNiQlTKFzQuyGQbnGdeQ5W+qlookjB9XeVY6rhKKBSIIhC8xEEgQqhTvNwNQnrxYg9bW/vYeRXEASscBKI4DFwIC4biOD1LCYpj+qFwAuHztLCj4xj2Ds5oYezshbC9E8D2yyP8D64gL1rqSreoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"트랜잭션 커밋시\"\n        title=\"트랜잭션 커밋시\"\n        src=\"/static/3c68e6ae05da7023236cda1cba9090d4/1d69c/JPA_3_4.png\"\n        srcset=\"/static/3c68e6ae05da7023236cda1cba9090d4/4dcb9/JPA_3_4.png 188w,\n/static/3c68e6ae05da7023236cda1cba9090d4/5ff7e/JPA_3_4.png 375w,\n/static/3c68e6ae05da7023236cda1cba9090d4/1d69c/JPA_3_4.png 750w,\n/static/3c68e6ae05da7023236cda1cba9090d4/78797/JPA_3_4.png 1125w,\n/static/3c68e6ae05da7023236cda1cba9090d4/aa440/JPA_3_4.png 1500w,\n/static/3c68e6ae05da7023236cda1cba9090d4/26162/JPA_3_4.png 2020w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"3-엔티티-수정\" style=\"position:relative;\"><a href=\"#3-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%88%98%EC%A0%95\" aria-label=\"3 엔티티 수정 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 엔티티 수정</h4>\n<ul>\n<li>JPA는 엔티티를 수정할 때는 단순히 엔티티를 조회해서 원하는 데이터를 변경하면 OK</li>\n<li><code class=\"language-text\">update()</code>라는 메소드는 존재하지 않음</li>\n<li>\n<p><code class=\"language-text\">변경 감지</code> 기능을 사용해서 데이타베이스에 자동 반영</p>\n<ul>\n<li>플러시 시점에 스냅샷과 엔티티를 비교해서 <code class=\"language-text\">변경 감지</code>함</li>\n</ul>\n</li>\n</ul>\n<p><strong>업데이트 기본 전략</strong></p>\n<p>JPA의 업데이트 기본 전략은 모든 필드를 업데이트함 !</p>\n<ul>\n<li>모든 필드를 사용하면 수정 쿼리가 항상 같음.</li>\n<li>동일한 쿼리를 보내면 데이터베이스는 이전에 파싱된 쿼리는 재사용.</li>\n</ul>\n<h4 id=\"4-엔티티-삭제\" style=\"position:relative;\"><a href=\"#4-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%82%AD%EC%A0%9C\" aria-label=\"4 엔티티 삭제 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 엔티티 삭제</h4>\n<p>엔티티를 삭제하려면 먼저 삭제 대상 엔티티를 조회해야 한다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">Member</span> memberA <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 삭제 대상 엔티티 조회</span>\nem<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>memberA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// 엔티티 삭제</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<ul>\n<li>엔티티를 즉시 삭제하는 것이 아님</li>\n<li>삭제 쿼리를 <code class=\"language-text\">쓰기 지연</code> SQL 저장소에 등록</li>\n<li><code class=\"language-text\">em.remove(memberA)</code>를 호출하는 순간 영속성 컨텍스트에서 제거</li>\n</ul>\n<h2 id=\"4-플러시\" style=\"position:relative;\"><a href=\"#4-%ED%94%8C%EB%9F%AC%EC%8B%9C\" aria-label=\"4 플러시 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 플러시</h2>\n<p>플러시는 영속성 컨텍스트의 변경내용을 데이터베이스에 반영하는 동작</p>\n<p>플러시 동작 절차는 아래와 같다.</p>\n<ol>\n<li>변경 감지가 동작하여 영속성 컨텍스트에 있는 모든 엔티티를 <code class=\"language-text\">스냅샷과 비교</code> 하여 수정된 엔티티 검출 및 수정 쿼리를 <code class=\"language-text\">쓰기 지연 저장소에 등록</code></li>\n<li>쓰기 지연 저장소의 쿼리를 DB에 전송</li>\n</ol>\n<p>플러시하는 방법은 3가지가 있음.</p>\n<ol>\n<li><code class=\"language-text\">em.flush()</code> 를 직접 호출</li>\n<li><code class=\"language-text\">트랜잭션 커밋 시</code> 플러시 자동 호출</li>\n<li>\n<p><code class=\"language-text\">JPQL 쿼리 실행 시</code> 플러시가 자동 호출 </p>\n<ul>\n<li>식별자를 기준으로 조회하는 <code class=\"language-text\">find()</code>의 경우에는 호출 X </li>\n</ul>\n</li>\n</ol>\n<h3 id=\"플러시-모드-옵션\" style=\"position:relative;\"><a href=\"#%ED%94%8C%EB%9F%AC%EC%8B%9C-%EB%AA%A8%EB%93%9C-%EC%98%B5%EC%85%98\" aria-label=\"플러시 모드 옵션 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>플러시 모드 옵션</h3>\n<p>플러시는 2개의 옵션을 가지고 있음</p>\n<ul>\n<li><code class=\"language-text\">FlushModeType.AUTO</code> : 커밋이나 쿼리를 실행할 때 플러시( default )</li>\n<li><code class=\"language-text\">FlushModeType.COMMIT</code> : 커밋할 때만 플러시</li>\n</ul>\n<p>주의할점</p>\n<ul>\n<li>플러시는 영속성 컨텍스트와 DB간의 동기화 작업일 뿐, 영속성 컨텍스트가 관리하는 엔티티를 지우는것이 아님.</li>\n</ul>\n<h2 id=\"5-준영속\" style=\"position:relative;\"><a href=\"#5-%EC%A4%80%EC%98%81%EC%86%8D\" aria-label=\"5 준영속 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 준영속</h2>\n<p>준영속이란 영속상태의 엔티티가 영속성 컨텍스트에서 분리된것을 의미</p>\n<blockquote>\n<p>준영속 상태의 엔티티는 영속성 컨텍스트가 제공하지 않기 때문에 앞에서 본 기능들을 사용할 수 없다.</p>\n</blockquote>\n<p>준영속 상태로 만드는 방법은 3가지가 있음</p>\n<ol>\n<li>em.detach(entity): 특정 엔티티를 준영속 상태로 만드는 메서드</li>\n<li>em.clear(): 영속성 컨텍스트를 왼전히 초기화</li>\n<li>em.close(): 영속성 컨텍스트를 종료</li>\n</ol>\n<h3 id=\"엔티티를-준영속-상태로-전환-detach\" style=\"position:relative;\"><a href=\"#%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A4%80%EC%98%81%EC%86%8D-%EC%83%81%ED%83%9C%EB%A1%9C-%EC%A0%84%ED%99%98-detach\" aria-label=\"엔티티를 준영속 상태로 전환 detach permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>엔티티를 준영속 상태로 전환: detach()</h3>\n<p><code class=\"language-text\">detach()</code> 메서드는 더 이상 영속 컨텍스트가 관리하지 않는 상태로 만들기 때문에 아래와 같은 동작이 수행된다.</p>\n<ul>\n<li><code class=\"language-text\">1차 캐시 제거</code></li>\n<li><code class=\"language-text\">쓰기 지연 SQL 저장소에서 관련 SQL 제거</code></li>\n</ul>\n<h3 id=\"영속성-컨텍스트-초기화-clear\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%B4%88%EA%B8%B0%ED%99%94-clear\" aria-label=\"영속성 컨텍스트 초기화 clear permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영속성 컨텍스트 초기화: clear()</h3>\n<p><code class=\"language-text\">em.clear()</code> 는 영속성 컨텍스트를 초기화해서 해당 영속성 컨텍스트의 모든 엔티티를 준영속 상태로 만든다.</p>\n<h3 id=\"영속성-컨텍스트-종료-close\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%A2%85%EB%A3%8C-close\" aria-label=\"영속성 컨텍스트 종료 close permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영속성 컨텍스트 종료: close()</h3>\n<p><code class=\"language-text\">em.close()</code>는 엔티티매니저를 아예 종료함으로써 준영속으로 만드는 것</p>\n<h3 id=\"준영속-상태의-특징\" style=\"position:relative;\"><a href=\"#%EC%A4%80%EC%98%81%EC%86%8D-%EC%83%81%ED%83%9C%EC%9D%98-%ED%8A%B9%EC%A7%95\" aria-label=\"준영속 상태의 특징 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>준영속 상태의 특징</h3>\n<p>준영속 상태의 특징은 아래와 같다.</p>\n<ul>\n<li>\n<p>거의 비영속 상태에 가깝다</p>\n<ul>\n<li>영속성 컨텍스트가 관리하지 않으므로 제공하는 기능을 누릴수 없기 때문</li>\n</ul>\n</li>\n<li>\n<p>식별자 값을 가지고 있다</p>\n<ul>\n<li>한번 영속 상태였던 적이 있기에 식별자 값을 가지고 있음</li>\n</ul>\n</li>\n<li>\n<p>지연 로딩을 할 수 없다</p>\n<ul>\n<li>지연 로딩 역시 영속성 컨텍스트를 통한 기능이기에 사용을 못함</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"병합\" style=\"position:relative;\"><a href=\"#%EB%B3%91%ED%95%A9\" aria-label=\"병합 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>병합</h2>\n<p>병합은 준영속 상태의 엔티티를 다시 영속 상태로 변경하는 것</p>\n<p><code class=\"language-text\">persist</code>의 동작과 비슷하지만, <code class=\"language-text\">merge</code>는 인자로 받는 엔티티가 비영속, 준영속을 따지지 않고 받음.</p>\n<p>단지, 1차 캐시에서 조회가 안되면 DB를 조회하여 캐싱한다고 보면 됨</p>\n<blockquote>\n<p>영속성 컨텍스트의 save or update 이라고 생각 !</p>\n</blockquote>","tableOfContents":"<ul>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#1-%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EB%9E%80\">1. 영속성 컨텍스트란?</a></li>\n<li>\n<p><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#2-%EC%97%94%ED%8B%B0%ED%8B%B0%EC%9D%98-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0\">2. 엔티티의 생명주기</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EB%B9%84%EC%98%81%EC%86%8D\">비영속</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EC%98%81%EC%86%8D\">영속</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EC%A4%80%EC%98%81%EC%86%8D\">준영속</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EC%82%AD%EC%A0%9C\">삭제</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#3-%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%9D%98-%ED%8A%B9%EC%A7%95\">3. 영속성 컨텍스트의 특징</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#1-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%A1%B0%ED%9A%8C\">1. 엔티티 조회</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#2-%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%93%B1%EB%A1%9D\">2. 엔티티 등록</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#3-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%88%98%EC%A0%95\">3. 엔티티 수정</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#4-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%82%AD%EC%A0%9C\">4. 엔티티 삭제</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#4-%ED%94%8C%EB%9F%AC%EC%8B%9C\">4. 플러시</a></p>\n<ul>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%ED%94%8C%EB%9F%AC%EC%8B%9C-%EB%AA%A8%EB%93%9C-%EC%98%B5%EC%85%98\">플러시 모드 옵션</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#5-%EC%A4%80%EC%98%81%EC%86%8D\">5. 준영속</a></p>\n<ul>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A4%80%EC%98%81%EC%86%8D-%EC%83%81%ED%83%9C%EB%A1%9C-%EC%A0%84%ED%99%98-detach\">엔티티를 준영속 상태로 전환: detach()</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%B4%88%EA%B8%B0%ED%99%94-clear\">영속성 컨텍스트 초기화: clear()</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%A2%85%EB%A3%8C-close\">영속성 컨텍스트 종료: close()</a></li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EC%A4%80%EC%98%81%EC%86%8D-%EC%83%81%ED%83%9C%EC%9D%98-%ED%8A%B9%EC%A7%95\">준영속 상태의 특징</a></li>\n</ul>\n</li>\n<li><a href=\"/category/study/jpa-programming/chapter3-persistence-context/#%EB%B3%91%ED%95%A9\">병합</a></li>\n</ul>","frontmatter":{"title":"[JPA 프로그래밍] 3. 영속성 관리","description":"","date":"2020.10.18","emoji":"⏰","category":"study"}}},"pageContext":{"slug":"/category/study/jpa-programming/chapter3-persistence-context/","relatedPosts":[{"node":{"fields":{"slug":"/category/study/jpa-programming/chapter7-persistence-context-and-jpql/"},"frontmatter":{"title":"[JPA 프로그래밍] 7. 영속성 컨텍스트와 JPQL","date":"2020.11.11","emoji":"📦","category":"study"}}},{"node":{"fields":{"slug":"/category/study/jpa-programming/chapter6-object-oriented-query-language/"},"frontmatter":{"title":"[JPA 프로그래밍] 6. 객체지향 쿼리 언어","date":"2020.11.04","emoji":"📝","category":"study"}}},{"node":{"fields":{"slug":"/category/study/jpa-programming/chapter5-relationship-mapping/"},"frontmatter":{"title":"[JPA 프로그래밍] 5. 연관 관계 매핑","date":"2020.10.27","emoji":"🤼‍♂️","category":"study"}}},{"node":{"fields":{"slug":"/category/study/jpa-programming/chapter4-entity-mapping/"},"frontmatter":{"title":"[JPA 프로그래밍] 4. 엔티티 매핑","date":"2020.10.22","emoji":"⛳️","category":"study"}}}]}}