{"data":{"site":{"siteMetadata":{"title":"Jay 기술 블로그","author":"won0935","siteUrl":"https://won0935.github.io"}},"markdownRemark":{"id":"4da2e1a0-116e-5c2c-9ef5-baf6b929dd95","excerpt":"…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p><code class=\"language-text\">자바 ORM 표준 JPA 프로그래밍</code>이라는 책으로 스터디를 진행하던 도중 공유 되었던 이슈를 포스팅으로 공유하고자 합니다.</p>\n<p>먼저, 공유된 이슈가 어떤 상황인지 이야기하고 <code class=\"language-text\">@Transactional</code> 어노테이션을 사용할 때 발생한 이슈와 <code class=\"language-text\">JPQL</code>을 사용할 때 발생한 이슈에 대해서 알아보겠습니다.</p>\n<h2 id=\"무엇을-테스트-하려-했는지-예시\" style=\"position:relative;\"><a href=\"#%EB%AC%B4%EC%97%87%EC%9D%84-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%98%EB%A0%A4-%ED%96%88%EB%8A%94%EC%A7%80-%EC%98%88%EC%8B%9C\" aria-label=\"무엇을 테스트 하려 했는지 예시 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>무엇을 테스트 하려 했는지? (예시)</h2>\n<ul>\n<li>\n<p>포스팅의 좋아요 수 정보를 증가시키기 위해 JPQL로 업데이트하려고 했다.</p>\n<blockquote>\n<p>코드 리팩토링의 과정에서 변경 감지를 이용하지 않고 JPQL을 사용했다.</p>\n</blockquote>\n</li>\n</ul>\n<p>그러나, JPQL로 업데이트 한 이후에 해당 엔티티를 조회했더니 운영 환경, 테스트 환경의 결과가 달랐다.</p>\n<h2 id=\"엔티티-코드-정보\" style=\"position:relative;\"><a href=\"#%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%BD%94%EB%93%9C-%EC%A0%95%EB%B3%B4\" aria-label=\"엔티티 코드 정보 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>엔티티, 코드 정보</h2>\n<p><strong>Post 엔티티</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@DynamicUpdate</span>\n<span class=\"token annotation punctuation\">@ToString</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> postId<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> likeCount<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>PostRepository</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PostRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Modifying</span>\n  <span class=\"token annotation punctuation\">@Transactional</span>\n  <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"update Post p set p.likeCount = p.likeCount + :count where p.postId = :id\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">int</span> <span class=\"token function\">updateLikeCount</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> count<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"문제-상황-2가지\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9-2%EA%B0%80%EC%A7%80\" aria-label=\"문제 상황 2가지 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 상황 2가지</h2>\n<p>결과가 다른 2가지의 상황이 있습니다.</p>\n<ol>\n<li>테스트 환경에서 쓴 코드</li>\n<li>운영 환경에서 동작을 확인하려고 쓴 코드</li>\n</ol>\n<p>각각 다음과 같습니다.</p>\n<p><strong>1. 테스트 환경에서 쓴 코드</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringtestApplicationTests</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Autowired</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">PostRepository</span> postRepository<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Test</span>\n  <span class=\"token annotation punctuation\">@Transactional</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> 테스트<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Post</span> post1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"세상을 바꾸는 IT 동아리\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">likeCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Post</span> post2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"현직 멘토들이 가지고 있는 경험을 멘토들에게 공유해주는 멘토링\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">likeCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>post1<span class=\"token punctuation\">,</span> post2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">updateLikeCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"post -> {}\"</span><span class=\"token punctuation\">,</span> post<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span><span class=\"token function\">getLikeCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>2. 운영 환경에서 동작을 확인하려고 쓴 코드</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Runner</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationRunner</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PostRepository</span> postRepository<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationArguments</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Transactional</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Post</span> post1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"세상을 바꾸는 IT 동아리\"</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">likeCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Post</span> post2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"현직 멘토들이 가지고 있는 경험을 멘토들에게 공유해주는 멘토링\"</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">likeCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>post1<span class=\"token punctuation\">,</span> post2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">updateLikeCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"post -> {}\"</span><span class=\"token punctuation\">,</span> post<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span><span class=\"token function\">getLikeCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"JPQL이 반영된 이후 정상적으로 데이터를 가져옴 !\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"데이터 불일치\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"결과는\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC%EB%8A%94\" aria-label=\"결과는 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과는?</h2>\n<h4 id=\"테스트-환경\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD\" aria-label=\"테스트 환경 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 환경</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ad240da76561e431510af7e71a9380d5/e16b4/test-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABRUlEQVQoz02SW5aCMBBEWY4QkCQGSAIYHqNnZv8LqqmOCn7cU00FY1c3RUoJ67ZhXVdsVB8C2rbNKozjiEiknqYJrusQYjzq2+0G515qSbGmO577hn1dsm5LQhx6bPQnuYSEnj/QLZwxsO0VnTWZnhd01n6pRTFbjdA52KaGuzZZTa1giXmjVYW2vOBK2qo86oPLWRcdL+nZhXUOrTao6hplpVCqE/G++XiqbqCaE/GL3zTjwbgpeCwx4O57dlpTB0zsXJ6X6LGOnBujSwo5E98bjegsPFMOrC2TFE/O6k/m97Pjse+c4YKRHe9c0sKzdJ/zfKUWb+aC5Dx6n/F9j04Ww/k10uFj5DYZ16gyt6wEiaPqXFfH83lWluWLqsrkd2UcHFWxM0qOSpVPRPD85yBdxJcnOgxD9vxbP37PDi03rLXO/ANOPAG/FEfUuwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"테스트 결과\"\n        title=\"테스트 결과\"\n        src=\"/static/ad240da76561e431510af7e71a9380d5/1d69c/test-result.png\"\n        srcset=\"/static/ad240da76561e431510af7e71a9380d5/4dcb9/test-result.png 188w,\n/static/ad240da76561e431510af7e71a9380d5/5ff7e/test-result.png 375w,\n/static/ad240da76561e431510af7e71a9380d5/1d69c/test-result.png 750w,\n/static/ad240da76561e431510af7e71a9380d5/78797/test-result.png 1125w,\n/static/ad240da76561e431510af7e71a9380d5/aa440/test-result.png 1500w,\n/static/ad240da76561e431510af7e71a9380d5/e16b4/test-result.png 2546w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"운영-환경\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81-%ED%99%98%EA%B2%BD\" aria-label=\"운영 환경 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영 환경</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c28aa3139e8319369b9fa9f19871c25e/e49d9/production-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.53191489361703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVQoz41SWXKrMBDkKokTPxCLWMQmAQJkknf/C3V6iJ1y5SsfXdKMZmtNR9u+4Tg+ET4GLK5Hnms0TYPEWlzGEe/EZRhQ9z22dYWlf6A90i9nT7/45JS8aFkWrH6H3wzc2CLPNOq6hmLAW9fh2raItUZVlqiZUFXVCYkRyL25+zXjopKBLZPEyLIMSimkKoVKU568J8l5ij+OYyS0f+PZH43jgHleMNgKXVsjS3NIE8XuV8HThMaYs7FAYgSP+2OgaJomLLPH7A3/cIAuSK2uoEj3nfjHInFRoJRE0srzHAXt3xD/WVAM5yy6rkfPT5ZOMrp60L0j+QMkJzKmIeUZhnS1Ls4u0iRjx0TAuyCVyQR3ygKJ00+2TPm95XXHHgassyVdQzlQPpSCbFlkc71v1Dl3SkQkYwmRivyrFPqhHMKOW/jA8b/FbXWUTcnlcBFs9LLMeNl3XFh4IPbbDRPZzDLEtnGIwG8aT6oPRBsfQjgQDiZ4R1rfMkq4rFeB93ijzlzf4XP12CaHw7OgHTHTZ5saBSWmKLWU5xdfDD2gcbJo5QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"운영 결과\"\n        title=\"운영 결과\"\n        src=\"/static/c28aa3139e8319369b9fa9f19871c25e/1d69c/production-result.png\"\n        srcset=\"/static/c28aa3139e8319369b9fa9f19871c25e/4dcb9/production-result.png 188w,\n/static/c28aa3139e8319369b9fa9f19871c25e/5ff7e/production-result.png 375w,\n/static/c28aa3139e8319369b9fa9f19871c25e/1d69c/production-result.png 750w,\n/static/c28aa3139e8319369b9fa9f19871c25e/78797/production-result.png 1125w,\n/static/c28aa3139e8319369b9fa9f19871c25e/aa440/production-result.png 1500w,\n/static/c28aa3139e8319369b9fa9f19871c25e/e49d9/production-result.png 3100w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<ul>\n<li>위의 결과를 보았을 때, 무엇이 옳은 결과로 보이시나요?!</li>\n</ul>\n<p>이미지를 봤을 때는 운영 환경의 결과가 맞고 테스트 환경이 틀린 결과로 보이지만</p>\n<p>여기에는 2가지 문제점이 존재합니다.</p>\n<h2 id=\"2가지-문제점에-대하여\" style=\"position:relative;\"><a href=\"#2%EA%B0%80%EC%A7%80-%EB%AC%B8%EC%A0%9C%EC%A0%90%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC\" aria-label=\"2가지 문제점에 대하여 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2가지 문제점에 대하여</h2>\n<ul>\n<li>정말로 하나의 트랜잭션이 동작했을까?</li>\n<li>JPQL로 Update를 진행하고 난 뒤 Select로 가져온 데이터는 Update가 반영된 데이터가 가져와졌을까?</li>\n</ul>\n<p>JPQL의 쿼리는 항상 영속성 컨텍스트를 거치지 않고 바로 DB에 쿼리를 날립니다.</p>\n<p>현재는 운영 환경, 테스트 환경에 모두 <code class=\"language-text\">@Transactional</code>을 걸어둔 상태이므로 하나의 트랜잭션으로 동작해야합니다.</p>\n<p>하나의 트랜잭션이 정상적으로 동작했다면, JPQL은 DB 데이터는 변경했지만, 영속성 컨텍스트의 데이터는 변경시키지 않았으므로 Select시에 변경 되기 전의 데이터를 가져오는 것이 맞습니다.</p>\n<p>여기서, ‘JPQL을 사용한 이후 조회할 때 DB와 영속성 컨텍스트간의 동기화가 이루어지지 않았다’는 첫번째 문제점을 발견할 수 있습니다.</p>\n<blockquote>\n<p>첫번째 문제점</p>\n</blockquote>\n<p>그리고 운영 환경에서는 하나의 트랜잭션이 아닌 별도의 트랜잭션이 동작했기 때문에 JPQL을 실행한 이후 조회된 데이터에는 JPQL이 반영된 결과가 나왔다는 것을 알 수 있습니다.</p>\n<blockquote>\n<p>트랜잭션이 다르므로 영속성 컨텍스트도 다르니 찾는 엔티티가 없어서 다시 DB에서 데이터를 조회했을 것</p>\n</blockquote>\n<p>결국, ‘운영 환경에서의 <code class=\"language-text\">@Transactional</code>이 동작하지 않았다는 것’도 알 수 있습니다.</p>\n<blockquote>\n<p>두번째 문제점</p>\n</blockquote>\n<h4 id=\"첫번째-문제점\" style=\"position:relative;\"><a href=\"#%EC%B2%AB%EB%B2%88%EC%A7%B8-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"첫번째 문제점 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>첫번째 문제점</h4>\n<ul>\n<li>JPQL을 사용한 이후 조회할 때 DB와 영속성 컨텍스트간의 동기화가 이루어지지 않은 이슈</li>\n</ul>\n<p>그렇다면, JPQL을 실행한 이후 영속성 컨텍스트의 데이터를 동기화 시킬 방법이 있을까?</p>\n<h5 id=\"해결-방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"해결 방법 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방법</h5>\n<p>아래의 코드처럼 <code class=\"language-text\">@Modifying</code>의 <code class=\"language-text\">clearAutomatically</code> 옵션을 적용시키면 쿼리 실행 이후 영속성 컨텍스트를 초기화 시켜준다고 합니다.</p>\n<p>영속성 컨텍스트가 초기화 된다는 말은 이후 엔티티를 select시 바로 DB를 조회한다는 말과 동일합니다.</p>\n<blockquote>\n<p>1차 캐시에 데이터가 없을 것이므로</p>\n</blockquote>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PostRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Modifying</span><span class=\"token punctuation\">(</span>clearAutomatically <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 쿼리 실행 이후 영속성 컨텍스트를 초기화시켜준다.</span>\n  <span class=\"token annotation punctuation\">@Transactional</span>\n  <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"update Post p set p.likeCount = p.likeCount + :count where p.postId = :id\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">int</span> <span class=\"token function\">updateLikeCount</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> count<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>✔︎ 첫번째 문제점 해결</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/658a6201bd7dbad7efa023d5fc57caa2/87547/jpql-solution.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.808510638297875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVUlEQVQoz4WSy1LDMAxF+z1t3vEjThzHdpICHWbgH9j1//cXSUw6sAAWZ2zJ0fWVo5O9fWB+v8O83pH3N7xEj6cUcY0BrmvhtUIcB6TRCXkaJcf7ZbCYVC/xpHvoqsRpDBGMCwlxmvC8BOxMmBGskaLZaCkc2hqmrqTQNjXFjawCn5XFl+C0MAnKWGil0DQNqqrC5XJBURQoy1Lg+Hw+/8nDIQtqO2AcR0zk1FqLuq5FmC9o21bEuYiFf+Mh6GNG2ysYY+CcE0FFbv9z9IfDTC0bEVRaizN2dMAtc+5o/3vuyHPudLQr6xyQU8K+79i2DW4YpP1lWRBjxLqusu+6Tp7mgL/hrtjMD8EQEzIVMfv1Ck1OHRUs9NMiXZTzCj/P9KatxLz33iPQJQx//xDksUl0eAseG83dTngahUV1iEZhHQz2yclZ6Dskq5FprI58plgVF3wCI6AmjL3UVTEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JPQL 동기화 해결\"\n        title=\"JPQL 동기화 해결\"\n        src=\"/static/658a6201bd7dbad7efa023d5fc57caa2/1d69c/jpql-solution.png\"\n        srcset=\"/static/658a6201bd7dbad7efa023d5fc57caa2/4dcb9/jpql-solution.png 188w,\n/static/658a6201bd7dbad7efa023d5fc57caa2/5ff7e/jpql-solution.png 375w,\n/static/658a6201bd7dbad7efa023d5fc57caa2/1d69c/jpql-solution.png 750w,\n/static/658a6201bd7dbad7efa023d5fc57caa2/78797/jpql-solution.png 1125w,\n/static/658a6201bd7dbad7efa023d5fc57caa2/aa440/jpql-solution.png 1500w,\n/static/658a6201bd7dbad7efa023d5fc57caa2/87547/jpql-solution.png 3174w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"두번째-문제점\" style=\"position:relative;\"><a href=\"#%EB%91%90%EB%B2%88%EC%A7%B8-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"두번째 문제점 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>두번째 문제점</h4>\n<ul>\n<li>운영 환경에서 <code class=\"language-text\">@Transactional</code>이 동작하지 않았던 이슈</li>\n</ul>\n<h5 id=\"해결-방법-1\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95-1\" aria-label=\"해결 방법 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방법</h5>\n<p>Spring Boot에서 프록시는 <code class=\"language-text\">CGLIB</code>으로 동작합니다.</p>\n<blockquote>\n<p>바이트 코드를 생성하여 런타임 시점에 적용하는 방식</p>\n</blockquote>\n<p>동일한 <code class=\"language-text\">Bean(Class)</code>에서 <code class=\"language-text\">Spring AOP CGLIB</code>이 동작하지 않기 때문에 위의 <code class=\"language-text\">update()</code>메서드를 외부에서 생성하여 호출해야합니다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Runner</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationRunner</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PostService</span> postService<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationArguments</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    postService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<p><strong>운영 환경에서도 정상 동작하는 트랜잭션</strong></p>\n<ul>\n<li>\n<p><code class=\"language-text\">@Modifying</code>만 설정하고 위의 방법으로 트랜잭션을 걸었을 경우 트랜잭션이 잘 동작하니 초기 테스트 환경처럼 정상적으로 에러가 발생합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d30374db33665dd4381048eadbe1f568/9d362/transaction-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.78723404255319%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABy0lEQVQoz21S2Y6jMADrz4xayg2BkAPKFUpnVjtaaTX//ycehyndVtoHy0kIjmPn8PX3E79/XbEsA5zr4eYBjW7QqjdUZYQsL1GkMfJScFwgSRKEYbjhfD5veJ4f5tsHxusNprvAXgbYfoCoJKw64zqnUDpDIXKuFRB1hqpKOS8QJzHCJ7Edh25yeP/8g9mLUlATUltoY2HbFsoaCClRNQ3qhiwbCr/iZ01yX4PDsCxY1xXTPMG0ApIbcl6t1AaB0ogahZCcc7MxLYxtoa39YR6qjOHB3cb1Jjg7NDy9LAsKRYijeMsiYlYnIvDZBME9r2cOnjLcwSsrnlTXNSSvVZbZI3QvGNxxSlOEcYyU7L973sceu/BWirIdr+IzM9C6YLMVYv6c0/UbcdQaR3JSliykRkIh//0ZL6V4sVbW6I3GqBQs3epKoNWKzqstCpEmqPMciutVlr442p/Nw6Fm6IbtLc5hHAe+R4dpHDH0/VaCUgY9x35uWUZF8eg/z+WfQzbY0Z0XdPO88UxhoQc2PJEvW5uS7vKMGZ+OLOmE4F7U7u4hKCnYqgbvdLZOEzHi5masXpxOl+EC13fo+R477lP3AoUQiKLoRczjG+KrY2pIUEn0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"트랜잭셔널 이슈\"\n        title=\"트랜잭셔널 이슈\"\n        src=\"/static/d30374db33665dd4381048eadbe1f568/1d69c/transaction-error.png\"\n        srcset=\"/static/d30374db33665dd4381048eadbe1f568/4dcb9/transaction-error.png 188w,\n/static/d30374db33665dd4381048eadbe1f568/5ff7e/transaction-error.png 375w,\n/static/d30374db33665dd4381048eadbe1f568/1d69c/transaction-error.png 750w,\n/static/d30374db33665dd4381048eadbe1f568/78797/transaction-error.png 1125w,\n/static/d30374db33665dd4381048eadbe1f568/aa440/transaction-error.png 1500w,\n/static/d30374db33665dd4381048eadbe1f568/9d362/transaction-error.png 3278w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n</ul>\n<p><strong>✔︎ 두번째 문제점 해결</strong></p>\n<ul>\n<li>\n<p><code class=\"language-text\">@Modifying(clearAutomatically = true)</code>를 적용시키면 운영 환경 또한 잘 동작하는 것을 확인할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a9b0ddf6858bc9f19330d87df041b12b/9d362/transaction-solution.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.319148936170215%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzklEQVQoz4VSa4+bMBDkr5zulBYMhIcBP8CEVwhXVVGl6v7/P5kb0ySKTpXuw8jWrj27M7vBx98rrr8vOJ9HLMsJyzxAW43eHmBUAaUdlMwgqwpFKZEXGZI0QZL8H8G8/cK4brCuR9sPaE8DylpBNyHWOYM2OYkylERRpZAy3UlFHCMMwx1RFCG63QM3LXi//sG8vsOS0LgBjWnZZQtlNKqmZoGaZ7PfZd2grOov+BfzueC8bVjXFct5QddLqEazgwKybRGSNDYWgsi1RudVdA6Gcdt2+6mtRevcftaNQjCtF2g+bli9KBOkSQpBCfExxQ8i9NK8JBFBCIGYEF/wHAs0K0kp6VGJlGZ7P+7J6P7wFtu9+gZBrS27U2gp0ZgaSinE7Co+HvGTiHgXz0W+JzR7d56ooHdpmj6SYpcqHnhI9EWe7nc8JDuaOk0jHIdSc1pFnqOirwdaceD+HbwdjDWctofixJXi1Jmr+CbLMhypxpMGfv/GccS8TJjPErYxOLJL2XV4aS1eWexVK+QkPA3DPl1Le1zf7yhY7LGLXrLpegxc5mme+KGA5lInrFRyDV748W0nblFyC7beYT312IYTLjznjsR1heRmjZf8CV/WYRs03/7XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"트랜잭셔널 해결\"\n        title=\"트랜잭셔널 해결\"\n        src=\"/static/a9b0ddf6858bc9f19330d87df041b12b/1d69c/transaction-solution.png\"\n        srcset=\"/static/a9b0ddf6858bc9f19330d87df041b12b/4dcb9/transaction-solution.png 188w,\n/static/a9b0ddf6858bc9f19330d87df041b12b/5ff7e/transaction-solution.png 375w,\n/static/a9b0ddf6858bc9f19330d87df041b12b/1d69c/transaction-solution.png 750w,\n/static/a9b0ddf6858bc9f19330d87df041b12b/78797/transaction-solution.png 1125w,\n/static/a9b0ddf6858bc9f19330d87df041b12b/aa440/transaction-solution.png 1500w,\n/static/a9b0ddf6858bc9f19330d87df041b12b/9d362/transaction-solution.png 3278w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n</ul>\n<p><strong>참고</strong></p>\n<ul>\n<li><a href=\"https://cheese10yun.github.io/spring-transacion-same-bean\">https://cheese10yun.github.io/spring-transacion-same-bean</a></li>\n<li><a href=\"https://mommoo.tistory.com/92\">https://mommoo.tistory.com/92</a></li>\n</ul>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>이처럼 스터디때 공유된 내용은 쉽게 실수할 수 있는 문제 2가지가 모두 있었습니다.</p>\n<p>정확한 개념을 알고 있는 것이 중요하다는 것을 다시 한번 깨달았고 저도 생각하지 못했던 이슈를 공유하는 유익한 시간이었던 것 같습니다 !</p>","tableOfContents":"<ul>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%EA%B0%9C%EC%9A%94\">개요</a></li>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%EB%AC%B4%EC%97%87%EC%9D%84-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%98%EB%A0%A4-%ED%96%88%EB%8A%94%EC%A7%80-%EC%98%88%EC%8B%9C\">무엇을 테스트 하려 했는지? (예시)</a></li>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%BD%94%EB%93%9C-%EC%A0%95%EB%B3%B4\">엔티티, 코드 정보</a></li>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9-2%EA%B0%80%EC%A7%80\">문제 상황 2가지</a></li>\n<li>\n<p><a href=\"/category/blog/spring-transactional-precautions/#%EA%B2%B0%EA%B3%BC%EB%8A%94\">결과는?</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD\">테스트 환경</a></li>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%EC%9A%B4%EC%98%81-%ED%99%98%EA%B2%BD\">운영 환경</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/blog/spring-transactional-precautions/#2%EA%B0%80%EC%A7%80-%EB%AC%B8%EC%A0%9C%EC%A0%90%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC\">2가지 문제점에 대하여</a></p>\n<ul>\n<li>\n<ul>\n<li>\n<p><a href=\"/category/blog/spring-transactional-precautions/#%EC%B2%AB%EB%B2%88%EC%A7%B8-%EB%AC%B8%EC%A0%9C%EC%A0%90\">첫번째 문제점</a></p>\n<ul>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">해결 방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/blog/spring-transactional-precautions/#%EB%91%90%EB%B2%88%EC%A7%B8-%EB%AC%B8%EC%A0%9C%EC%A0%90\">두번째 문제점</a></p>\n<ul>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95-1\">해결 방법</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/category/blog/spring-transactional-precautions/#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n</ul>","frontmatter":{"title":"[Spring] @Transactional 사용 시 주의점과 JPQL 주의점","description":"","date":"2020.11.14","emoji":"🚧","category":"blog"}}},"pageContext":{"slug":"/category/blog/spring-transactional-precautions/","relatedPosts":[{"node":{"fields":{"slug":"/category/blog/graphql-introduce/"},"frontmatter":{"title":"[GraphQL] GraphQL에 대해서","date":"2020.11.25","emoji":"📘","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/spring/redis/spring-data-redis-version-issue/"},"frontmatter":{"title":"[Spring] Spring Boot 2.3.2.RELEASE 버전 Redis 이슈","date":"2020.11.20","emoji":"❓","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/spring-jpa-one-to-many-save-issue/"},"frontmatter":{"title":"[Spring JPA] 1:N 관계 엔티티 save시 update 쿼리가 추가로 발생하는 이슈","date":"2020.09.25","emoji":"💭","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/aws-eb-deploy/"},"frontmatter":{"title":"[AWS EB] AWS Elastic Beanstalk로 서버 배포 하기","date":"2020.09.02","emoji":"🚀","category":"blog"}}}]}}